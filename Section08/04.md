In this video, we are going to explore some of the limits of wavelet convolution, and you will see

that when two features of a signal are too close together in the frequency domain, then they can be

difficult to separate using time frequency analysis methods in particular.

We're going to use wavelet convolution here.

This is a good illustration of one of the important ways of using simulated data to understand data

analysis methods, and you will see that very soon.

OK, so let's get started here.

We specify these simulation parameters, sampling rate of a kilohertz, three seconds worth of data.

And here I specify the time vector to go from zero to just under three seconds, but then I subtract

one.

So in fact, this time vector is going to go from minus one to plus two.

So what I'm going to do to create these two signals is create two transient oscillations.

In fact, these are just going to be more like wavelets themselves.

So it's a real value sine wave multiplied by a Gaussian.

And you can see they're fairly close in frequency.

So 10 hertz and 13 hertz.

And then the Galson is going to be the same, so it has a full with half maximum of three hundred milliseconds

and the difference is that the peak time will be slightly shifted.

So signal one will have a peak time at one second and signal to the peak time at one point, one seconds.

So yeah, as I said, sign two pi times the time vector and then it's time times the Gaussian.

And now if you look at this carefully, this might look a little bit different.

Normally I have this set up is E to the minus four times natural log of two times time squared or time

minus the center time point squared.

At some point I should probably change the variable name from P time to something that's a little bit

less suggestive.

So but typically I do it time squared over the full with that half maximum squared.

But here this looks a little bit different because I'm not squaring the time vector and I'm not squaring

the four with the maximum instead of dividing them first and then squaring the that entire division.

So I will let you ponder this alternative formulation for a minute, OK?

And then I'm adding a little bit of noise, partly because somehow I don't like to have your signals.

I like to have them be at least a little bit noisy.

But also, it's going to be interesting to see how this magnitude of noise is present in the time domain

versus the time frequency domain.

OK, so these are for the two individual signals.

Now I'm creating the full signal.

This is the signal that I'm going to analyze, and that is simply the sum of these two individuals signal

components.

All right.

So and then a bit of plotting.

So let's see how this looks.

So here you see the two signals, signal one and signal two.

So we get this transient oscillation here and some noise.

You can see that these are largely overlapping in time.

There's a little bit of a shift, but they're largely overlapping in time and they technically don't

overlap in frequency.

But you will see in a minute that it's not necessarily so straightforward in a time frequency analysis

to differentiate these in terms of spectral decomposition.

Anyway, this is the two signal components.

This is the thing that we are actually going to be analyzing.

It's the sum of these two signals.

All right.

So now we specify parameters for the time frequency analysis.

So I'm going to go from two hertz to 20 hertz in 60 steps.

The wavelet time vector is going to go from minus two to plus two.

And I have the frequencies increase logarithmically.

And let's see what else there's going to be a constant Geilston with five hundred milliseconds, we're

going to change this and a little bit and yes, some other convolution parameters.

OK, so here's the convolution.

This is almost identical to code you've seen in the past few videos.

There is, however, one major difference, which is that in the previous videos, I had a separate

for loop to create the complex, more wavelets, but now I have one loop that creates the wavelets and

then runs convolution immediately.

Now, either way is fine.

I tend to find this a little bit more useful in terms of programming, but sometimes it is actually

necessary to have a separate loop to create the wavelets.

For example, if you need to run this analysis over many channels.

So then you don't want to recreate the wavelets for each channel.

Anyway, so create the complex Morleigh wavelet, here's the complex sine wave and the Gaussian.

And here I'm creating the wavelet actually directly inside the FFE function.

And then this normalization in the frequency domain, which I introduced you to in the previous video,

here is the convolution itself and then extracting power here.

OK, so I'm going to run this code and then we will spend some time talking about it.

Oops, I didn't run this code yet.

OK, so here you see the result.

This is time and frequency and now it looks like it's kind of just one blob.

In fact, you can kind of see, I guess there's two blobs that have merged together, but clearly the

Tennet sine wave and the 13 hertz sine wave are not completely separable using this time frequency analysis

with the parameters that I have selected.

So now that we see the basic result, there are several things that I want to show you.

One thing I would like to show you is about this wave time and the time vector more generally for creating

the wavelets, it's really important to have the wavelets be constructed with their own time vector

and not using the same time vector that you used to create the signal.

Now, the reason for this is that it's really important to have the wavelet centered at zero where zero

is also the center of the time vector.

So you can see this time vector goes from minus one to plus two for the signal.

Now, if I were to create this wavelet time to go from minus two to three, let me show you what the

result is going to look like there.

So you see all of a sudden this feature of the time frequency plane looks identical to how it just looked,

except now it's slid over to the left and now it peaks at around 2.5 seconds.

And this is definitely incorrect, because when you look here, you see that the peak time should be

one second and one point one second for the two signals.

And here it's peaking at point five seconds.

Now, this happened because the wavelets have become shifted in time.

So I can show you this.

I'm going to plotts.

Let's see.

It's.

This so I want to plot.

The real part of one of the wavelets plot, and then I'll take the real part like this, so now you

can see that this wavelet is shifted from the center and so this phase shifts.

Let me make this even more clear.

Axis tight.

OK, now you see that this has shifted.

So this would be the center.

Twenty five hundred points.

And this phase shift is introducing a phase shift in the results.

So it's very important to be careful that your time vector for the wavelet is always symmetric around

zero.

So there you go.

Now it's correct.

Another thing I would like to point out is that this level of noise noticed how much noise there is

in this signal.

Now, this is not an overwhelming amount of noise.

It's still pretty easy to recognize the signal and distinguish it from the ongoing noise.

But it's still pretty clear that there's noise.

And now if you look at this time frequency, but you don't really see much noise at all, I guess we

can change the color scaling here.

Let's see what this color scaling is.

So I'm going to lower the color scaling a bit, so zero, let's say, point O one, that's a bit extreme.

OK, but you still don't really see any broadband noise around here.

And what's happening is that there is broadband noise.

But all of the noise that you see here, this gets spread over the entire frequency spectrum because

this is true broadband noise.

So when you spread this over the entire spectrum, it ends up being really, really small for any individual

frequency.

So simply by doing a time frequency analysis, we have already increased the signal to noise ratio.

All right.

So now what I'd like to do is show you that we can actually separate these two signals in the time frequency

analysis by increasing the precision, the spectral precision of the wavelengths.

I'm going to set this to, let's say, a full width of a half maximum of the wavelet for the more they

wavelets to one point five seconds.

So considerably longer.

Yeah, that's OK.

All right.

So now at one point five seconds.

It's now pretty clear that there are two features on this time frequency plane that can make this even

more extreme by studying this to be two, and now it becomes even more clear that this is.

Do features, however, we don't get the increase in spectral precision for free, it comes at a cost

and the cost is a decrease in temporal precision.

So now you see it looks like this feature of the time frequency plane starts at, you know, almost

all the way out to minus one point five seconds and it goes all the way up to the end of this plot.

And that is not really consistent with how we simulated the data.

So here these two features, these two signal components, or maybe we can even look here.

You can see this really only starts here at around, you know, point seven, five or point eight seconds.

But this time, frequency plot suggests that we have energy here going all the way even before time

zero.

Now, in contrast, if you make this full with that half maximum smaller, you make the Gaussian thinner

or the more like wavelet thinner, then we get much better temporal precision.

But now it's really not possible to see that there are two separate spectral components.

So this highlights one of the fundamental difficulties of time frequency analysis, that there's always

a trade off between temporal precision and spectral precision.

The more precise you want to be in time, the worse the spectral precision is going to be like what

you see here.

And the more precise you want to be in frequency, then the less precise you will be in time and that

you see in this example.