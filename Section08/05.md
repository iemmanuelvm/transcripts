 So far in this section of the course, all of the time, frequency analyses have been implemented basically on one trial or one epic of data, a one time series. However, in practice, in empirical data sets, you often have multiple Epic's multiple trials, multiple repetitions of the same event, and you want to perform a time frequency analysis on all of those trials. Now, there's two ways that you can do this. One way is to first average the data over all of the repetitions average over all the trials, generate an ERP and then do a time frequency analysis on that one average trial. That's a valid method. There's nothing really wrong with that per say, but that provides limited insights into the data set. In particular, if there are none phase locked or temporally jittered activity. And you saw this phenomenon, this distinction between a spectral analysis of single trials versus spectral analysis of the trial average in the previous section of this course on spectral analysis. So the same principle applies here. If you have multiple trials, you would probably want to perform a time frequency analysis on each trial separately and then extract time, frequency, power from each trial and then average the time, frequency, power across all of the trials. Now, if you scroll down here, you'll see that I have no loop that goes over trials. So there's a loop that goes over frequencies, of course, because we are using multiple wavelets or wavelets at many different frequencies to do the time frequency analysis. But you don't see anything about trials. There's no loop over trials. In fact, there's a little trick that I used to do. Convolution over all the trials in one shot, in one go. And in this video, I want to explain a little bit more how that works. This is a good way to save time. Make your analyses run faster with less code, which means also less chance of making coding mistakes. And also it's a useful conceptual way to think about multiple trial convolution. OK, so let's start by loading in the data. And I just want to remind you again of what these data look like. So we have this structure, EEG, which is contained in this not file here. And one of the most important fields in this EEG structure is called data EEG data. And it is sixty four by six hundred and forty by ninety nine. So sixty four channels, six hundred and forty nine point ninety nine repetitions. So in this video, we're going to pick one channel, you'll see. In a later video in this section, how to deal with time frequency plots from many channels. But here, we're just going to pick one channel, so that's going to give us a time by Trials Matrix. So the question is, what is the way to perform convolution on that time by trials matrix over each trial separately without having to do a loop. And the answer comes from this line here. So what I do is I say take the data from this channel. So all this line of code here, the same string, compare the channel that this variable channel to use, which is that one with the labels of all of the channels. So that's going to find let me set this. That's going to find the number. So the index of the channel that corresponds to a one. So you can see those factors, all zeros. These are all falsies. And it's going to be true here. Here is the one true element. So Channel 27 is has the label one that's in the back of the head? OK, so what I do here is I take all the data from this channel all the time, points all trials, and then reshape that into a one by Hertz. It's as empty, but this means one by whatever that number happens to be. So let's see what that number happens to be. So now all data is a vector of one by sixty three thousand and sixty three thousand happens to correspond to hundred and forty time points times ninety nine trials. So now you can see if I would plot all data. So here you see all the data. Let me zoom in. So here are the first six hundred and forty time points is going to correspond to trial one, and I can also demonstrate that you are saying hold on and I'm going to plot EEG, that data from this Channel 27 all the time points and try one. And let's make these red circles. And now you can see that these overlap. So the red circles and the blue lines overlap up until here where the red circles stop and they stop here because this is the end. This is the last time point in trial one. And then we go into the first time point of trial to. All right. So with that said, then we keep this as a single vector and then the convolution. So in the convolution, we just pretend like we only have one trial of data. So let's see. Let me run all of this code. Now, when you're setting up the convolution, you have to be really careful about this parameter and data, the number of time points that ultimately goes into the number of time points for the convolution or the number of frequencies for the convolution. So here it's not just the number of time points. It's actually the length of all data, which is the number of time points times the number of trials. OK, so now here's the loop over frequency. And you can also see that I'm creating the wavelet directly inside this loop. I don't have to have a separate loop to create the wavelets. You'll notice that's going to be different from a video and, you know, later in this section on dealing with multiple channels. So visualizing time, frequency, power from all channels. Because there we are going to need a separate loop to create the wavelets anyway, so the wavelet is created directly inside this loop over frequencies. And let's see, so here is the convolution. And now let me set this up for the first iteration. So now you see that this variable I call is asked for analytic signal. This is also 63000 time points, but that's not what we need. We need to reshape these data back into a time by trials matrix. And the reason why I want to shape this back into time by trials is because I went to average over trials. So now I've reshaped this back to six hundred forty by ninety nine. Now here you can see first time extracting power as the magnitude squared and then I'm taking the mean the average over the second dimension, which of course is trials. So now I can run this cell and make a plot. And now you can see here is the time, frequency power pop from this one channel or one over all of the ninety nine trials. Now, I have no idea what I was thinking when I decided to make this color map spring. It looks very bright and colorful in a way that makes me think of like some little girl and her pet unicorn or something like that. I'm going to change this to color my pot. OK, if you like, you can play around with different color maps and see what you like.