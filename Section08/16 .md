In most of this section of the course, I've used wavelet convolution as a way to extract time, frequency

information from a signal.

What I want to do in this video, which will also set you up for the next project, is show you a different

way of doing time frequency analysis, and that is by Narrabeen filtering and then applying something

called the Hilbert Transform.

Now, I've already talked about filtering and how to implement filtering or at least a little bit about

how to implement filtering in the section on time domain analysis about low pass filtering earpiece.

And I talk in much more depth about filters and creating narrowband filters and then pass filters and

Benschop filters in my signal processing course.

But that's OK.

You don't need to take that course to get through this video.

I'm going to show you the basic design of setting up a narrow band FBAR filter.

I'm going to use the function FLIR one to create the filter.

This is actually basically the same as far less.

In fact, when you call fire one, Matlab is actually calling for else and just setting the parameters,

making some assumptions for you.

So let's say you want to create a narrowband filter that will isolate activity between 10 hertz and

15 hertz.

So the way that you do that is by using this FIA one function and it takes primarily two inputs.

Depending on how you're using this function, you might need to add additional inputs.

But for narrowband filter, two inputs are all you need.

So the second input, I'll talk about the first one in a minute.

The second input is this frequency range here that you specify and this gets specified in Hertz.

But the input needs to be in a fraction of the Nyquist frequency.

And of course, the next frequency is one half of the sampling rate.

So that's why this is the second input.

And this is actually useful because FIA one doesn't care about Hertz or whatever unit you are using.

Fire one should be a general function that will return a filter, Colonel, regardless of the unit or

the domain in which you are working.

OK, so that's the second input.

The first input is the order of the filter.

And this is a fancy term, but it's basically just the length of the filter.

So you can make the filter col longer or shorter.

And let me actually first show you this and then I will talk about the order a little bit more.

So here the output of the FIA, one function is the filter kernel and then herem computing its power

spectrum.

That's one of the ways that you evaluate the the quality of a filter.

So here you see the filter, Colonel, in the time domain, and you'll notice that it actually looks

a little bit like a wavelet, it's not exactly like a wavelet.

It's a little more kind of, I don't know, wobbly.

It's a little more complicated than a Morleigh wavelet that you've seen plenty of times already in this

section.

So the order is basically just the number of points in the filter.

So you can see here the order is two thousand filter kernel is actually going to be one point longer

than the order.

So the question is, how do you know how long to or what order parameter to specify?

Unfortunately, this is a difficult parameter to be able to specify with confidence.

There are some rubrics for specifying the minimum possible order, but the minimum acceptable order

is not necessarily a good order that you want to work with.

And the reason has to do with how this filter will behave in the frequency domain.

And that's the whole point of computing the power spectrum of the filter, and so let me show you that.

So here is how the power spectrum looks.

So, again, this is the time domain, if you take the FFE of this and take the magnitude of the FFE

squared, that gives you the power spectrum.

And what you want to do is compare that against the quote unquote ideal filter, which is essentially

just this frequency range that you've specified.

So the ideal filter in this case with these parameters would be zero gain.

So this is the power spectrum that you can think of it as the gain and the frequency domain.

So it should have zero game below 10 hertz and zero gain above 15 hertz, and you can see that the actual

filter doesn't match exactly this ideal filter, but it's pretty close.

And overall, it looks pretty good.

We don't see a lot of ringing.

You don't see like ripples.

You don't see that.

It's kind of getting all crazy here around the edges.

You can see that it's actually a little bit tighter.

So let me even zoom in to this part a little bit more, as I said, get current access.

Excellent.

Let's go from like, how about seven to 20?

Maybe that's a good range.

All right.

So now you can see I think I'll even move this up a little more.

Let's go for nine to 17, maybe 16.

OK, so first of all, now that we're zooming in, you can see that there are a little bit of gentle

ripples up here, not so bad, but you can also see that the filter is actually tighter than the ideal

filter.

So you specified that it should go from 10 to 15 hertz.

But you can see that at exactly 10 hertz, the actual gain is around point to five.

So you're attenuating around 75 percent of the signal at 10 hertz.

Of course, it goes up quickly, but you don't get full gain with this filter until around.

Let's see what this is exactly the current data cursor mode.

So you don't get to 100 percent gain until you get to not that one.

This is stuck on the red one, the other one, well, anyway, until you get to let's just estimate

that this is around 11 hertz.

This is in general a feature of the filter, colonel, resulting from the FIA one function, if you

want this to be a little bit wider.

So you're still getting more energy passing through the filter at 10 hertz and at 15 hertz, then you

might consider using NFR else.

Filter, Colonel Construction, and that's going to basically widen this filter out a little bit and

give you a little bit better coverage inside your requested frequency range.

OK, so here is where the order becomes really important.

So because the order of the filter kernel specifies the number of time points in the time domain signal,

then that also defines the frequency resolution.

And that's because the frequency resolution is determined by the number of time points.

So the longer the colonel in the time domain, the the better the response in general is going to be

in the frequency domain.

Now, that's not arbitrarily the case, eventually you get the order to be so high and you're going

to start getting some weird effects in the frequency domain as well.

But on the other hand, if you have a longer order, you have a longer filter.

It's also just going to take much longer to filter the data.

So your analysis will slow down.

So that said, let me show you a few different examples.

I'm now going to specify this to be.

So this is basically the sampling rate divided by the lower edge of the frequency, which basically

encodes how many time points you need for this lowest frequency.

So this is one way of specifying this.

So this, we say, is a constant.

And here you multiply this by some factor and I have a factor of 20.

And now if you look at the results, this is even where I don't want to say it's worse per say, but.

Certainly you get even less coverage, so even less data is passing through this filter.

Now, let's try to just make this a bit extreme.

So now with an order of 200, this frequency response looks terrible.

You never even get up to a gain of one.

At best, it's a gain of around point seven.

And I mean, it's pretty obvious that this is a terrible filter.

OK, on the other hand, if we would set this to be like 200 now, this looks nearly perfect here,

but this is going to be a really, really long filter.

So 20 thousand time points this is going to give you is going to be a nightmare.

This will take forever this analysis.

OK, and then I didn't talk about this third panel, but this is exactly the same as this panel just

plotted in log space so that you can see.

Here, so here I take 10 times out of 10 of the filter power.

So that's just converting this.

And that's because, you know, looks like the game is at zero down here, but it's actually not zero

gain.

It's not a full complete suppression of activity at the rest of the spectrum.

It's just a very large suppression.

So the DB goes down to about minus 60 and then down from there.

OK, so once you have the filter kernel, then you apply the filter kernel to the data.

And this part is no different from the low pass filtering that we that I introduce you to in the earpiece

videos.

So I'm using the filter function for a zero phase shift filter and then here I'm applying the Hilbert

transform and let me run the cell.

The idea, the purpose of applying the Hilbert transform is to obtain something called the analytic

representation of a signal.

Essentially what the Hobart Transformer is doing is taking the Fourier transform of your input signals

to the filtered data, and it rotates the four year coefficients and then applies the inverse Fourier

transform.

And that basically gives you a complex signal that has both a real part and an imaginary part.

And the idea is that for a relatively narrow band filtered signal, the result of the Hilbert transform

is comparable to the complex result from complex, wavelike convolution.

So what I'm plotting here is the on this top panel.

This is the filter data and the real part of the Hilbert transform.

And you can see those overlap.

So the real part of the Hilbert transform is exactly the same as the signal that you put into the Hilbert

transform.

So filt that and real of Hild that are the same.

Here you see the real part and the imaginary part and not surprising, those are fascinated by Piver

two by 90 degrees.

And here this is Fatime frequency analysis.

Most of you're going to be extracting the analytic envelope of the result of the Hilbert transform and

that you can see here, ABESS.

And then, you know, sometimes you could also square this to make this a little bit more clear, how

to interpret this and what this means.

This is a time course of the energy in the signal at the frequency there that you used for creating

this filtered signal.

So let's see, I'm going to turn zoom off.

It's like this thing I pulled on and now I'm going to plot this on top.

Let's plot this in black.

OK, so now and I think I'll zoom on again.

So now here you see the real part and the imaginary part.

In blue and orange and this thin black line going on top, this is the magnitude that's the same thing

is being plotted here.

So you can see that this is like the sometimes called the analytic envelope or the amplitude time series.

And if you square this, you would get the Power Times series and you can see how it's tracing out the

energy of the signal over time at this frequency.