In this video, you are going to get more exposure to the event related potential or ERP, this is probably

the most commonly used analysis for time domain investigations of neural time series data.

I want to start by reviewing the theory of an ERP.

So why is it useful?

Why is it sensible to create an ERP?

And we'll do this initially through a simulation.

Now, this is not much different from the simulation that you learned about in the previous section

of the course.

So I won't spend a whole lot of time discussing the details.

This mainly just to say what we are going to be doing is creating a signal, embedding that signal and

noise and showing that averaging over multiple repetitions will give you back a result that looks more

like the signal than any individual trial.

OK, so let's go through let's see if we can just run this whole so I'm going to press control, enter

and OK, so already there's an error and it's an error with the cost, the cosine function which is

here.

So it's pretty clear what the error is.

There is no inputs provided into the cosine function at this point.

I encourage you to pause the video, go through all this code line by line, not only to make sure you

can fix these lines.

For example, this one and I don't know, maybe there's some problems elsewhere, but also just to make

sure that you understand what's going on and what the point is of each line of code.

So let's start going through this line by line.

So I'm going to set all these parameters.

We can quickly look through these parameters.

So we have some basic simulation details like the sampling rate.

The time goes from minus one to plus two seconds.

There's going to be one hundred trials.

And then we have s phreak, which according to the comment is the sine wave frequency and hertz.

So nine hertz.

Here's a variable called G Peak T, and it might initially not be obvious what that refers to.

But if you look down here at the line that creates the Gaussian window, you can see that that's time

minus this variable.

So this is the Gaussian peak time.

That's what that stands for.

And then here's the Gaussian with in seconds.

So two hundred millisecond wide Gaussian and then we have standard deviation for the noise.

OK, so here we're creating a signal.

So that needs to look like cosine of two times PI times frequency, which is called s four times time.

Now, you'll notice there's no phase of that and there's no amplitude modulation here.

There's also no corresponding parameters for those sine wave parameters.

So you can add those if you like, although it's not terribly important for the simulation here.

All right.

Here's where we create the Gaussian, and it kind of looks like a normal Gaussian formula right here

e to something divided by the width squared.

And then here we create our signal.

So I would like to see what it's looking for.

I didn't run that length.

OK, so no errors, no warnings.

And I would like to have a look at this thing so I can say plot time by signal.

And let's see what this signal looks like.

Aha.

So it is a flat line all the way here and then all the way at the very end it jumps up to ten to the

forty six.

Now I'm going to go out on a limb here and say that something is probably wrong.

So something is wrong with the signal then something is wrong with either the sine wave or the Gaussian

or both.

So let's try and plot these.

I'm going to plot the S wave.

OK, that looks like a normal sine wave.

Nothing weird going on there.

So now let's try plotting the girl's window.

Aha.

And this looks a little weird.

Maybe you already noticed that this line of code was not exactly correct.

And this is tricky because there are no matlab errors.

There are no coding errors on this line of code.

There is just a math error.

In fact, there's two.

And if you haven't already spotted the two, then try and pause the video and see if you can figure

them out.

So it turns out one is that time needs to be squared.

So we need a square here and the other is that the numerator needs a negative sign in here somewhere.

So now let's try this again.

So I'm going to start by plotting the Gaussian window.

And this now looks great.

Looks like a normal Gaussian.

It peeks at one which is expected because there's no amplitude modulator here.

And the peak time is it's hard to see exactly where it is here, but it's very plausibly point four,

three.

OK, so now we can plot the signal and this looks good.

So it's a transient oscillation that we are simulating here.

All right.

So here what I do is use the function rep not to repeat this signal by the number of trials and one.

So this is going to give me a matrix of one hundred by fifteen hundred, which corresponds to one hundred

trials and fifteen hundred time points.

Now you you might remember from the previous section, there's video about the egg structure.

And I said that in the egg lab structure, the data are always formatted, formatted as channels by

time, by trials.

And so this one might seem a bit opposite because it's trials by time, instead of time by trials.

So if you prefer it the other way, then that's fine.

You can change things up.

You can transpose this matrix, but for now it doesn't really matter.

So now I say this data and actually we can look at this data.

We can make an image of this data and it looks like nothing terribly interesting is happening on the

Y axis.

Everything is happening on the X axis.

And that's because we've taken this signal and exactly reproduced it one hundred times.

So now what I'm going to do is say that data matrix equals itself, plus random numbers.

That's the same size as this matrix of trials by time and then times the noise amplitude that we specified

here.

OK, so let's run that.

And now let's see if this plot encode is correct.

Yeah.

So here we plot the original signal, the pure signal here.

I'm creating an image of the data now.

I just showed you an image of the data before adding noise.

So here's what it looks like after adding noise.

Now it's really hard to find the signal in here.

You kind of can if you know what to look for, you can see that as you go as you look up and down here,

you can see that there is some reliable pattern here going vertically.

But if you didn't know that this was a signal, it might be hard to find that.

Now, what I'm going to do is compute the average of the data.

And this is the average over the first dimension, which is trials.

And so that looks like this.

And so this shows you the big idea of computing an event related potential.

You have some pure signal.

You have a lot of noise or some variability maybe.

And when you average over trials, you can recover part of the original signal that you don't see in

the single trial data.

So this pattern is really, really hard to see in here.

Now, you can play around with this.

You will find, for example, that if the noise amplitude is smaller, the.

A point to then you don't really need to average so much or maybe you can average over 10 trials or

something, and if the noise is larger, let's say if it was amplitude 12, then this is still now so

big, I have to get rid of this.

Why scaling now?

You really don't see anything.

Now, if you knew for certain that there was a little wave here, you can kind of see it.

But that's really not certain.

You know, I mean, this basically looks like this.

So eventually you add enough noise that 100 trials is not enough.

Maybe adding a lot more trials will be sufficient.

Let's see what happens if we go for a thousand trials.

OK, starting to look a little bit better, but you can see there's a balance between averaging versus

the amount of noise in the signal.

All right.

So that is simulated data.

What I want to do now is explore earpiece a little bit in real data.

So we are going to load in this data set.

So V1 Laminar OUTMATCH.

Now, here's an interesting comment.

It says first time seeing these data and maybe this is so we should inspect the first time you load

in a math file.

It's useful to see what is contained in that math file and I type who's.

But now the question is, which of these variables were actually inside this math file?

Because a lot of these variables we created up here.

So therefore, if you don't need any of the other variables in your workspace, which in this case we

don't, you can type clear, get rid of everything and now we can see, oh, we don't see anything.

Right.

We need to load in the data again.

That's just easy to make matlab mistake.

OK, now I type who's now I see three variables and these are all the variables that are contained inside

this matte file.

So there's a variable called S rate, which is obviously the sampling rate.

There's a variable called Time VEC, which is obviously going to be a vector of time points.

And then there's this variable cost.

And based on this information and based on what we know about how neural time series data are typically

stored, particularly in the EEG lab toolbox, we can guess that this data matrix includes sixteen channels,

fifteen hundred and twenty seven time points and two hundred trials or two hundred repetitions.

And that is in fact what this data contains.

OK, so now let's do a little bit of plotting.

For starters, we're going to plot just the data from one channel, so the ERP from one channel.

And here, let's just run this and see what happens.

OK, we get an error with plot and it says data cannot have more than two dimensions.

So you can see if you can figure out what's the problem here.

This seems OK, right?

We are plotting from CFD and we're planning the channel that we want to plot and then all time points.

All right.

But in ERP is the average over all trials.

So we're going to need a mean in here like this.

So and which dimension do we want to mean over?

It's not going to be the first dimension because that only has one element.

It's not going to be the second dimension that's averaging over time.

So it is in fact the third dimension, which is trials.

So let's try this.

And that looks pretty good.

Now, run all these other lines of code.

This is basically just making the plot look a little bit nicer.

So I have these vertical dotted lines here that correspond to the onset of two visual stimuli on the

screen.

So there is a visual stimulus that appeared here and here you see a response.

And then there was a second visual stimulus that appeared here.

And then you see another response, which is pretty interesting.

Now, this horizontal dash line here is supposed to go on zero from, you know, the beginning of the

plot to the end of the plot.

However, it looks like it doesn't spend the entire plot.

It looks like it just goes from one zero to one.

So looking at this code, you can see there's a little typo.

This says get get current access.

Selam, which is the color limit and color limit, doesn't really make much sense here for a line.

But in fact, this is supposed to be X limn.

So we want to draw a line that goes through the entire X axis limit at the Y coordinates of zero and

zero.

So this is a little hint here.

This is actually a mistake that I really made when I was writing this code.

And I admit that it took me a good 10 or 15 seconds to figure out why this line didn't go to the end.

All right.

So now that should look better.

Let's get rid of this, OK?

Now, this spans the entire X axis.

Now, what I'm going to do is plot all the trials from this channel.

So I'm going to use image C, and that looks pretty interesting.

So essentially, what you're looking at here is like the marginal mean.

If you would take the average at each time point across all 200 of these channels.

Now, this is interesting to compare against this.

Here we see a ton of noise and so lots and lots of noise.

There's much less noise here.

You can see all of the data happening in the single trial level.

It's also interesting to note that looking at this gives you a lot of information.

One thing you see, for example, is that it appears that there's a block of trials, a group of trials

here that don't have much of a response here.

So you see this.

If you look at this peak, there's a big response here and a big response here.

And really nothing is happening here.

Now, why exactly that is the case, I don't know, based on just looking at these data.

But if these were real data, then it might be I mean, these are real data.

But if these are your data that you're analyzing an experiment, you might want to look at plots like

this and see if you can figure out if something went wrong in these this group of trials.

Maybe, I don't know, something went wrong with the experiment.

Maybe something went wrong with the individual.

Maybe the subject just fell asleep for a little bit now.

Could be totally normal.

It's just natural variation that happens.

And maybe that's what we're looking at here.

Anyway, it's just interesting to look at single trial data in addition to the trial average data.

OK, the final thing that I want to show is the data for all of the channels.

So this is an ERP for one channel.

And now let's see what the ERP looks like for all the channels.

So here I am using the contour function and what we're going to show, what we're going to make a control

map of is the average of this matrix.

And now we're not selecting only one channel.

We're selecting all the channels all the time points, all the trials and averaging over the third dimension,

which again is trials.

OK, so this looks like some modern work of art.

It's a little bit hard to know what to make of it.

So part of the reason for this is that it's a bit low resolution.

So I want there to be more contours.

I'm going to add an optional fourth input into the control function, which is the number of contours.

So.

Right now, it's drawing 10 countries, that's the default, I guess the default isn't 10, I forget

what the default is anyway.

I find that 40 countries tends to look pretty good.

However, this does not look pretty good.

This looks pretty difficult to interpret because all the countries have these black drawn ISO contour

lines around them.

So I'm going to turn those off by typing line color none.

Now, this is starting to look pretty.

This is starting to look like something you would print out and hang up on your mom's refrigerator.

OK, but what are we looking at here?

So it turns out I didn't tell you about this data set yet, but now I will.

This was a very small, very thin electrode that was lowered down into the brain of a mouse into the

visual cortex.

This is a painless procedure.

And anyway, the mouse was deeply anesthetized.

So there is a linear probe.

It's a very thin, long probe that looks like this.

So it looks like a just a really skinny pencil, for example.

And along that thin electrode are 16 contact points.

So 16 electrodes.

And that is what you see here.

So that is where the 16 comes from.

The 16 electrodes and there were lowered down into the brain to sit in the middle of the cortex.

So this is the top of the cortex and this is the bottom of the cortex towards the center of the brain

and towards the outside of the brain here.

And what you see is that when a visual stimulus appears on the screen here and then there is a different

visual stimulus here, you see that these different layers, different vertical layers of the cortex

are responding differently to this visual stimulus.

And in particular, it's interesting to look at here.

So Channel six or seven, this is the earliest where you can detect information in the visual cortex.

So here you see that this red blob starts speaking earlier than this blue blob.

And here it's a little more apparent here that this red blob is earlier.

And then later in time, you see this blue blob here and then a red blob here.

And basically, one of the things that this kind of plot will tell you is where is what's called layer

four doesn't correspond to electrode for its cortical, therefore.

And that is the part of the cortex that gets the first input from the outside world, from the sensory

environment.

So the neurons, the brain cells in this part of the cortex and this depth of the cortex get the information

from the eyeballs first.

And then once the information is processed here, that information is then transmitted to deeper layers

and also to more superficial layers.