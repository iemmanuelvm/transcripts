 In this video, we're going to compute the average reference of the scalp EEG sample data set that we've been working with. It's this one. The data, as they are in this math file are average to linked earlobes, so that means that while we recorded the EEG on the scalp, we also recorded two additional electrodes on the left and right earlobes. And then offline, we computed the average voltage of the two earlobes and then referenced all of the scalp channels relative to the earlobes. And now what we want to do is reference to the average of the scalp EEG data that's sometimes called car or car for common average reference. And it basically means that after you compute the average reference, then the entire topography has an average value of zero at every time point. So if you would sum up the voltage values across all the channels at any given time point, that sum would be zero or at least very, very close to zero. So in computers, it's going to be not exactly zero but zero plus some computer rounding error. OK, so we are going to do this in two ways via a double loop. So we're going to loop over trials, loop over time points, and then we're going to do it in one line of code using a function because it's fun. OK, and then we will compare these two methods to make sure that they are the same. So the first thing I want to do is initialize some new variables. In fact, these are going to be new fields of the EEG structure. I call it car data one and car common everyday reference data two. If you are not familiar with this function deal, it's a pretty useful function. You can input any matrix or vector or string or you input anything and the function deal will return identical objects to however many variables you list here. So this is basically just a way of initializing both of these fields, both of these matrices car data one and car data two to the same Xeros matrix. Now I'm going to compute average reference via a double loop, so the main part of this computation is done in this line. And so we say the EEG data for all the channels at this time point and this trial equal. So it's this and we're reassigning this to be equal to. The data for, again, all channels and this time point and this trial minus the mean of the same thing, which means they mean over all the channels. So essentially we are just means entering every time and trial point. So I'll run this line of code or this cell that takes you out, took maybe two seconds to run. Now I'm going to run it again using this function. But it's fun. This function takes three inputs. The first is the operation that you want to perform. So we want to perform minus and then the thing that you want to perform the operation on, which is EEG, the data, and then you have to say the thing that you want on the other side of this expression. So that's going to be the average of all the EEG data over all the channels. So let me show you the sizes of these things. I'll say the size of this. So this is a one by 640 by ninety nine. So remember, this is ten points. This is trials, this is channels. And here we only have one quote unquote channel, which is actually the average value for all sixty four channels. And now we can look at the size of big data and that is sixty four channels by the same thing. So what fun is going to do is recognize that in order to make this work, this matrix will need to be replicated sixty four times. So that's the way of subtracting the average value from all of the individual time and trial points over all the channels. So it's pretty fancy and it's also considerably faster than running this double loop. And here I want to show you that those get the same results. So I'm going to generate three plots. First is going to be the raw data. Again, this is with the ear lobe reference and then the common average reference data from the loop, the double loop and then from both X1. So here you can see how they look here and right is the ear lobe reference and then in blue and black is the average reference, you can see that those are identical. We can zoom in if you don't believe me. And you can see no matter how much you zoom in, they are going to be the same. So there's two things to notice, first is that a lot of the general features are the same between the ear lobe reference and the average reference, and that's a good thing. If the two earpiece look totally, wildly, qualitatively different from each other, then there must have been some kind of coding error. There must have been some mistake somewhere. They should look overall similar, but not identical. The second thing you can notice from comparing these two groups is that in towards the beginning and towards the end, they don't really differ that much. Looks like there's a little bit less noise. But here in the middle, they differ a bit more. And essentially what that's telling you is that this particular channel boss had a larger voltage deflection than the average that is the average of all the electrodes. So therefore, when it was earlobe reference, it was relatively high when you computed the average reference you were actually taking out part of. The signal that was common across all of the channels, OK, and there actually is a third thing that I would like to know about this, which is that it looks like the red line, that your little reference is a little more noisy and the average is a little cleaner. And in fact, I'm going to let me see. I want to get rid of this here and record it just so it's a little bit easier to look at visually to compare the blue line in the red line. So this is something that you see fairly often with average referencing and basically the difference, the fact that the ear lobe reference is a little bit noisier tells you that there is some noise that's affecting basically all the channels, which could also in this case mean that there was noise affecting the ear lobe channels and that noise was common or relatively common across all the channels. So when you subtract out the channel, I mean, the data actually get a little bit cleaner because you're removing some of the noise that is common across all of the channel. So this is pretty useful to know how to compute average reference, you will see this come up several times in this course and in particular over the next several videos.