All right, so continuing on with this problem that we are now on problem to exploring edge effects,

what we want to do here is create a square wave time series and perform a time frequency analysis.

So here we are specifying the sampling rate of nine hundred and ninety nine hertz for some reason,

the number of points I'm specifying as some multiple of the sampling rate.

Now, of course, this is a bit redundant, just to say some variable times one.

But this is here just to indicate that it's going to be easy to change the amount of time.

If you want to change the duration, explore different durations of this time vector, you can just

multiply this by three, for example, or any number, and that will give you a signal.

That's this number of seconds.

And that's because the sampling rate is the number of time points per second.

So now we are simulating three seconds.

And of course, this doesn't have to be integers.

You can have three point five seconds.

So let's leave this at one here and here.

We create our time vector.

Here is our square wave pulse.

So we initialize it to be zeros.

And then the way that I'm doing this, I'm specifying that the the basically the from 40 percent to

60 percent through the signal.

And then this has to be rounded because, you know, endpoints times point four might end up being a

fraction.

And it doesn't make sense to talk about the three hundred ninety nine point six element in a vector.

So therefore we have to round this.

OK, so what should we set the height of this square wave to?

Well, it doesn't say anything, so let's just set it to one and let's see what this looks like.

So run all this code.

And this is Bocskor Time series.

I think it's supposed to say Boxcar Time series.

So here's our Time series.

We have two sharp edges and then the rest of the time series is nothing interesting.

So what is going to happen when we do a time frequency analysis?

What will the time frequency power of this Boxcar Time series look like?

You can probably already guess because I showed you some pictures of this a few videos ago, but it

will be interesting to confirm experimentally, analytically.

So let's see.

So we do time frequency analysis from one to one hundred hertz in eighty three steps and always have

to look through this stuff carefully because I forget myself what kind of bizarre mistakes I have coded

into this thing.

But this looks OK.

So let's continue until we get something weird or a little hint that something is wrong.

So number of cycles, 300 to 1500 cycles with this many cycles, this is effectively like the poor man's

Fourier transform because we're not you know, these aren't really going to be wavelets with such a

huge number of cycles.

Let's go three to 15.

I think that's a fairly reasonable thing.

So here we have a function.

So impulse function, that's what this is called, our boxcar.

I'm calling it impulse function and then X for spectrum.

So let's see then we are initializing our time frequency matrix.

So this is going to be frequencies by time.

And I'm guessing this is for power and phase.

So let's run that.

And now here we do.

We create so we have a loop over frequencies.

We create our complex Morleigh wavelet.

So two times X squared, where S is the number of cycles normalized by two pi f and then we have E to

the I to 50 times E to the minus T squared time divided by two square.

OK, so that part looks good.

And then here is the spectrum of the wavelet and then here is so we have to normalize.

OK, let's see.

So complex mulloway X equals complex Ma'aleh X divided by the maximum value of the spectrum.

So that does the normalization so that we get unit gain at the peak frequency.

So here we have the second and third steps of convolution, which I often call the meat of convolution.

So that is the spectrum of the wavelet times, the spectrum of the data, which was called impulse function

X.

All right, then we cut back down, so we trim the wings off and then we compute power and phase.

That is not the way that we compute power.

I mean, technically, this is the way we compute power, this is the way we compute phase.

But this needs to be indexed into the time frequency matrix.

And let's see what the SOS frequency by time by feature.

So frequency by time by feature for power.

And then we want frequency by time.

By feature two four phase, all right, this is fun.

I like doing this stuff.

All right, so now for plotting.

Let's see.

So we are going to make an image using the image as the function instead of Contar F and the first feature,

which is power, the second feature, which is phase.

And let's see what happens.

All right.

Pretty striking.

And actually, we're supposed to have I close that figure so we can see the plot better, but there

should be this Boxcar Time series.

All right.

So that is pretty frightening, maybe pretty terrifying to see what the time, frequency, power and

phase response look like to these edges here.

So let's see the questions.

How bad is it?

Well, it's hard to say how bad it is because we don't have endogenous activity on top of this.

Imagine, for example, this was a boxcar.

Imagine this was one Pekoe Volt and you have your data in millivolts.

So a Pekoe Volt step function is a tiny, tiny edge relative to the ongoing signals, which are orders

of magnitude larger.

So if that's the case and it's not bad at all, on the other hand, if this is in millivolts but your

data are recorded in micro volts, then your data are these tiny, tiny, tiny fluctuations all the

way down here.

So this step, this edge here is ginormous relative to your data.

So it's hard to say how bad it is just by looking at it.

We'd have to know a little bit more about the the magnitude of this signal.

Let's see, does the edge more adversely affect power or fail?

Well, it's difficult to say, in part because so you might be tempted to say that the phase is more

strongly affected because it looks like this this weird disturbance in the phase extends further out

compared to power.

But it's difficult to make that determination because in part, a phase is, you know, pretty much

uninterpretable out here where the power is essentially zero.

And secondly, this is based on some particular color scale.

So I think I didn't even set this.

So I did set this color scale.

But for example, imagine I would set this color scale down lower.

I wanted to this one.

So now it looks like it's wider and we can make it, you know, the color scaling is a bit arbitrary.

We have no particular reason to say that this particular magnitude of color scaling is appropriate.

So, unfortunately, I think it's a little difficult to answer this question with confidence.

OK, so what would you consider a reasonable buffer in terms of the I'm going to let me set this back

to its original color scale.

OK, so what would you consider to be a reasonable buffer in terms of cycles per frequency to avoid

the edge effects?

Now, I have said previously that I generally recommend having three cycles at the lowest frequency,

which would be down here at 10 hertz, and that should be a fairly safe window.

On the other hand, actually, if you look down here.

So let's let's zoom in here.

I'm going to say set y limb to go from 10 to, let's say 30 just so we can zoom in here and actually

give you the lowest frequency was was OK, so let's do up to 10 hertz.

So here is the edge at point four.

So at 10 hertz, three cycles corresponds to three hundred milliseconds and that would get you here.

So based on my recommendation of three cycles at 10 hertz, it seems like with this color scaling,

it seems like we are well past the edge effect here.

So it looks like the edge effect takes around one cycle at 10 hertz and you could do this for the other

frequency.

So for Hertz is a cycle of two hundred and fifty milliseconds.

So that would be point four and then 250 milliseconds gets you down to point one five.

So this looks like it's one cycle at each frequency.

Now, the thing is, as I mentioned in a few videos ago in the lecture, that, you know, three cycles

or one cycle is really just it's a bit of a rubric.

It's a bit of a guide.

Exactly how many cycles you need depends a bit on the the size of the edge relative to the other data

that you're looking at.

So in this particular case, it looks like the edge effect subsides within around one cycle.

So three cycles is definitely enough.

Does the size of the edge effect depend on the amplitude of the box?

OK, so that's pretty interesting.

What I'm going to do now is rerun this.

Actually, let me rerun this to make sure this gets back to how it used to look.

And then what I'm going to do is plot in figure six, all this same code, except now I'm going to set

this to be ten.

So then we're going to have an amplitude of 10 and everything else is going to be exactly the same.

All right.

So now you can see this amplitude here goes up to ten and here it's only at one.

So we can see it does look like it's worse.

So at the same color scaling, it seems like the time frequency power extends further.

It looks like it's wider.

And interestingly, the phase values are also basically the same.

So that, again, supports this idea that it's just really hard to interpret phase in these regions

out here because power is so small.

All right.

Does it also depend on the number of cycles for the wavelet?

So that's also a pretty interesting question.

I think I will leave this question to you.

I'm going to let you explore this question.

Essentially, what you want to do to answer this question for yourself, which is a pretty relevant

question, is to do basically what I just did.

So come up with a new figure plot in a new figure, and then you want to show or you want to rerun this

for different numbers of cycles.

So there's a couple of things you can try.

You can try setting it constant to be a low value and then setting it constant to be a high value.

And you can also try just changing the ranges, maybe three to five or maybe thirteen to twenty five,

you know, have fun, take some time, explore around and try and get a built some intuition for edge

effects.

All right.

So let's move on.

I'm going to go on to problems at three here.

So in the first section of this course, the introduction section, we looked at simulating data and

we were visualizing data and we discovered a failure scenario of time frequency analysis, you might

remember.

So I think that was in the problem set of the introduction section.

And essentially what we did was we created a signal, we simulated a signal that had to sign waves that

were fairly close, I think it was.

Three hertz and five hertz, and the time frequency power plot totally failed to isolate those two frequencies,

whereas the static spectral analysis really clearly separated those two frequencies.

So I said that that was a failure scenario.

And I also said that we would be able to fix it later on in the course.

So here we are later on in the course, and we are going to explore and hopefully resolve this issue.

So let's see.

What we are doing here is creating a signal that has two components, one at four hertz and one at six.

So we need to fill this in.

So this is a sign of two times PI times, four times frequency.

And this is going to be two times PI times.

Six times time.

I said frequency.

I meant time.

OK, so and then we take the power spectrum.

So this is the static power spectrum and let's have a look at this signal actually.

So plot time by signal and OK, so you see that there's two sine wave components or I don't know, it's

kind of hard to see even in this simple example, but it seems plausible that we have to sinusoidal

components.

All right.

So now we do the time frequency analysis.

We're going only from two to 12 hertz.

We don't need to go all the way up to one hundred hertz because we're not interested in frequencies

that high.

So here's our frequency range, the number of frequencies.

And, uh, let's see.

And looking through all this stuff, this all seems fine.

Here we are specifying the full with a half maxima to go from point five seconds up to point three seconds

from two to twelve hertz, OK?

And then we take the Fourier transform of the signal and it looks like I'm copying and pasting here.

So calling this impulse function NFTE is not a variable that's defined.

This actually should be an CANF like this.

OK, that looks good.

And then we actually what I think I'll do I haven't even looked at this static spectrum.

Let's plot ABS in fun x and essentially we expect there to be two peaks in this spectrum, which there

are also a lot of non stationary things you can see here.

That's pretty interesting.

And that base has to do with the fact that I didn't set up I didn't set this example up to have an even

number of cycles exactly fitting into the time window.

Plus, we are doing zero padding.

OK, so we don't this is not optimized for getting a really clean, easily interpretable static power

spectrum.

But that's OK.

That's not really the goal here.

Let's see.

So we have our frequency by time t f matrix here, we need to create the time domain wavelet using the

full with that half maximum formula, which I am sure that you remember.

So we need the complex sine wave that's e to the I times two times pi times frequency I times time and

then this is time for the wavelet.

So that's called wave time times wave time element wise multiply.

So dot start the Gaussian and that is e to the minus four times the natural log of two times.

We have time squared divided by the full with at half maximum and I call a plural plural for with rough

maximums.

It should probably be m√°xima but that's OK.

And then that thing is squared.

OK, so now I'm going to make sure that this gives a sensible results.

I'll set the looping index to be one.

And first of all, this should be complex valued, which is.

And then I want to plot this.

So there's going to be plot, uh, y of time and the real part of complex multi wavelet and very nice.

Looks like a more lay wavelet.

We can also plot the imaginary part.

We can plot the magnitude of ABSs.

OK, very good.

So always good to do this kind of sanity checking as you're going through writing code.

So now we want the for a series of the complex Morleigh wavelet and then this needs to be normalized,

of course so complex where X divided by the maximum of complex Morleigh Wavelet X.

All right.

Uh, this is interesting looking at this next line.

So here I say inverse f fifty of the wavelet spectrum divided by the signal spectrum or so times divided

by the maximum of the wavelet spectrum.

So that's pretty interesting.

We don't actually need this line here because I'm putting the normalization.

Directly into the element Y's multiplication, so we are doing the normalizing and the step two of convolution

and step three all at the same time, so that's a pretty neat little trick here.

Let's cut the wavelet back down to size and then get power, which is not the magnitude to the power

of two hundred.

That is slightly ludicrous.

We just want to square it.

OK, let's see if all of this code is going to run.

OK, it ran and it ran super duper fast.

Let's see.

So now we're planning the signal, we're plotting the time frequency plot and we have the static power

spectrum at the bottom.

OK, so here you see the signal, the time frequency plot and the static power spectrum.

So question, is the time frequency analysis completely, utterly worthless?

Oh, God.

I certainly hope that the answer to this question is no, it's not utterly, completely worthless.

So you can see actually in this case, you do see the two different frequencies, but they merge together

with this beat like pattern that corresponds to the difference of their frequencies.

So so four and six hertz.

And the difference between those is two hertz.

And then you see this beat rhythm at two hertz, which means twice every second.

So it's here point five and then one and point five.

And you don't see it here and you don't see it here just because these are the edges.

So we get a little bit of edge effect that's overwriting these things.

So if you would extend this out to, let's say, four seconds, you would really see this beat phenomenon

more prevalently.

OK, let's try changing the fool with maximum limits to see if you can recover these signals.

Can you get a better can you get it perfect?

OK, well, I don't know what perfect really means, but let's see if we can improve the situation.

So first of all, put this in figure seven and then let us think for a moment about what we want to

do here, how we want to change the number of cycles.

So what we want here is to have a better spectral resolution.

We want to have our precision.

We want more precise wavelengths in the frequency.

We want the the frequencies or the wavelengths to be narrow in the frequency domain, which means we

need them to be more spread out in the time domain, which means that these these parameters for air

traffic maximum has to increase.

Let's see what happens when I said it to point seven, and I'll just fix this to the point seven here

for the lower and upper bounds.

So then I'm going to run all of this code again.

And without changing anything about the frequencies, you know, I didn't change that frequency resolution.

I didn't change the number of frequencies.

All I changed was the full with maximum.

And all of a sudden that did a lot better.

That recovered very nicely, I would say the four hertz and six hertz components of this signal.

Now, of course, you get a little bit of attenuation here in the beginning and at the end that's related

to edge effects.

But presumably, you know, you have part of this is some buffer period, some some buffer zone.

So what you were actually interested in, let's say, would be like this middle time window here.

So that's pretty interesting.

So we have discovered that we can get it better.

So I don't really know what perfect means here.

But by changing the balance between temporal precision and spectral precision, we were able to overcome

the failure scenario that you saw in the very beginning of this course.

All right.

And with that, I think I will stop the video here and continue in the next video with problem for.

So see you soon.