 In this video, we're going to start putting together all the pieces of convolution wavelets complex, Morleigh Wavelets, extracting information or features from the results of complex Morleigh Wavelet convolution and so on. And what we are slowly building up towards is our very first full time frequency powerplant that is going to come in three videos from now. So you have to work through three more videos before you get to see your very first full on logit time frequency powerplant. That's going to be like the sort of thing you can print out and send to your grandmother and she will be so proud of you. OK, but let's start with this video on Complex Morleigh Wavelet Convolution. So we are starting out by clearing the workspace. It's always a good thing to do in the beginning. Gives you a nice, clean mental workspace. And it also makes sure that you're not going to be overwriting any variables or accidentally using variables that you've previously defined and so on. So let's see for now, we are going to start with only one trial. In the next video, we're going to start working with all of the trials using one of the tricks of convolution that I explained in a previous video. So let's see. So we get just one trial from one channel and we get an error. Why do we get an error? Well, of course, we cleared out the entire workspace, so we also lost the data. So that was called V1 Laminar. That matched. OK, let's try this again. Very good. So we get data, which is now just a single vector, and it's just to make things easier here. So here we are creating our complex Morleigh wavelet. You can see we are working down towards this line of code here. So complex Morleigh Wavelet. And that's the complex value sine wave times the Gaussian. So let's think about creating this time vector here from this line of code. This looks suspicious. This looks like exactly what I told you to avoid in several previous videos. I said that the time vector should be central. I mean, the time vector should be mean centered, so it should go from minus something to plus something. Otherwise you risk running our in introducing a phase offset in your data. And here we go from zero to two seconds. So this is not good. We are going to get a phase shift. However, the very next line shows that we are means centering, so we're subtracting the mean of time. So that's actually changing this time vector and now it basically goes from minus one to plus one instead of going from zero to two. So it's also completely fine way to define the time vector. As long as it's been centered, then it's OK. All right. So let's see. We are going to create a wavelet at forty five hertz here. You can see I'm using the other formula. So the formula where you specify the number of cycles for the Gaussian instead of specifying the full with a half maximum. So let's see. Here is our complex Marlay Wavelet. And now for Convolution Illman. We're really missing a lot of code here. We have to do a lot of stuff. OK, let's start with step one, the ends of convolution. So we need the end of the data. And that is simply the number of time points I'll call that length of time VEC. And then we need and kearn. That is the length of the kernel and that is going to be the length of the complex, more leeway that we need. The end of convolution. That's going to be NP data plus and Kurn minus one. Of course you remember this formula and then we need to know the half. OK, so half of the length of the kernel and I'll call that floor of and Kernen divided by two like that. OK, so that's step one. All the NS step two is to compute the fees. So we need the data X so the spectrum of the data and that is the F.T. of the signal and I call that what did I call it. Data. So data. And then it's the end for the fee of course is NP conv. So this is actually going to be longer than the original data. So and then we have now we could call this and current X because I use that here as well. So Kurn X equals fifty and then this is called the Complex Morleigh Wavelet. And then here's an interesting thing. So step two point five, normalize the wavelets so it has maximum energy or unit. At its peak, so let me show you what this means. Let's see that I run around this, so I need to run these things, OK? So just out of curiosity, I'm going to plot the magnitude of Data X, and this is not you know, I'm not these are not frequencies. These are just, uh, frequency indices, OK? Now, I would like to plot abs of Kurn X.. Now, notice that this amplitude spectrum of the wavelet, so it's shaped like a Gaussian, which we expect it is a one sided spectrum, which we also can expect. We certainly expect that the positive frequencies will not be identical to the negative frequencies because it's a complex valued signal. But notice the amplitude here. So this amplitude here gets up to at its peak, it gets up to around forty seven. Now the thing is that in convolutions of step three, I'm even going to write this down. So Confreres X equals data X, dot star Kurn X. Now notice when we multiply these together, what's actually going to happen is that these frequencies in here under this Gaussian will have increased energy in the data. We are boosting their energy by a factor of, you know, anywhere between one and forty seven all the way up here. So in fact, when we take the inverse Fourier transform, the amplitude of this convolution result is going to be 45 times larger at the peak frequency. Forty five times larger amplitude than what we had in the original signal. So we are artificially boosting the amplitude of the signal. So how do we correct for that? So we normalize in the frequency domain or in general, we normalize that the more they wavelength. Now, the thing is that normalization of the more they wavelet in the time domain is really tricky. It turns out to be a really hard problem, but normalizing in the frequency domain is trivially easy. All we do is divide by the maximum and that ensures that we have a maximum gain of unity. So now when we multiply the data spectrum and let's see, I'll do this. So now we multiply the data spectrum. So let's see. I'm going to say plotts abs of data X and then hold on plotts abs of confreres X. OK, so now you can see that the results of convolution is this orange line here and the amplitudes in this area are preserved, whereas the amplitudes below. So lower frequencies and higher frequencies are maintained. Again, these are frequencies and indices. These are not frequencies in Hertz. OK, so let me make another figure for you that looks just like this, but without running this line here, without doing this normalization. So I rerun this line of code, rerun this line of code, and then in a new figure will generate this plot again. Now you can see that the result of convolution has a much higher amplitude than the original signal. The shape is fine. The shape is still the same. So we haven't modified the shape of the spectrum, but the units are going to be wrong. The units are going to be inflated. All right. So that's a lot of verbiage. But that's basically why we have to run this line if you want to get back the result of convolution to be in the same units as the original data. So let's see then this and step four, now four. Step five, we cut off the wings of convolution and we can confirm that the length of the result of convolution is now 15 27, which is exactly the same as the length of the original signal that is here 15. Twenty seven. All right. Pretty cool. So now for plotting. Let's see. Uh, this seems fine in the sense that. I don't think so. I don't see any explicit coding errors. Let's just run all this and keep our fingers crossed. OK, nice. So here we see in blue is the data spectrum and in red. So the amplitude spectrum in red is the amplitude spectrum of the wavelet. And then in black is the amplitude spectrum of the convolution result. So that's basically the same graph that I just showed a moment ago. And here you see what it looks like in the time domain. So the blue is the original signal and the black is the result of convolution with this wavelength here. So we are isolating the activity in this fairly broad, frequent. So from about, you know, thirty five to fifty five hertz ish, we get some positive energy, of course, with the most energy at forty five hertz, which is where the peak of the Galson is in the frequency domain. So you can also see that this amplitude scaling looks pretty plausible here. And then I would like to go back and show you again what this will look like if we skip this step. So I have to run all of this business again and this will now go in figure 10 so we can compare and let's see all of this is the same. There we go. OK, so now you see the black line is just much larger amplitude, both in the frequency domain and, of course, in the time domain. Now, again, if you would change the Y axis scaling for the zooming, you would see that actually the black line here and the black line here are the same in terms of the shape, in terms of the temporal characteristics, in terms of everything, except for the overall scaling on the y axis here. All right. So now I want to where is this? Go back and rerun this. I'll just rerun all of this code here and skip the plotting. We don't need to do that down here. I'm going to extract the three features of the complex wavelet result. So let's see. We plot the filtered signal. That's the projection onto the real axis. That's nothing new. In fact, that's what we were already looking at before. So that is the narrowband filtered signal and the projection onto the real axis. And as I've explained in a previous video, this is going up and down. But when you think about the complex DOT product on a complex plane that the product is actually spinning around the complex plane like this and the projection onto the real axis, which is the x axis for the complex plane that's going back and forth like this. And that's why this is going up and down. This is the real axis here, whereas on the complex plane, the real axis is the x axis. OK, and then plot power. And I see there's a typo here, confreres. I wonder if that was intentional and oh, there's even more problems here. So this is plotting the imaginary or is plotting only the real part. But in fact, we want these squared magnitude from origin to product location in complex space. OK, so what we want is the Power Times series. How do we get the Power Times series? Well, we do abs the convolution result. This gives us the Amplitude Time series. So we're getting somewhere and that is like this envelope that's writing on top of these faster fluctuations. And then the instructions actually say that we should plot power, which is amplitude squared like this. All right. Very nice. So here you get the power spectrum and now you can directly compare these because the x axis are the same. So you can see when this signal gets more energetic, when it's going up and down with higher amplitude fluctuations, the power is getting much larger. OK, and then we plot the phase angle time series here. And this is basically expected. This is kind of how it always looks. It goes up. And then but when you put it on this Cartesian plot, it looks like it's sorta thing immediately down. But in fact, this is just a transition from a plus Pi to minus PI. So it's really just spinning, spinning around the circle like this. Now, there's another thing I would like to point out here, which is this little blip right here. So let's zoom into that. I'm going to say change the x axis limit from how about point seven to point eight? Let's see what that does. OK, maybe point six to point eight. Yeah, that looks better. Now, I'm going to set the axis limits to be the same over here and over here. So what I would like you to do is notice this little flip slip here. This is sometimes in neuroscience. This is sometimes called a phase slip. It looks like the phases are moving continuously at roughly the same speed. And then here we suddenly get this really sharp transition goes from one phase value and then immediately to another phase value. So this is sometimes called a phase slip. Now, this gets back to the discussion that I had in a video about uncertainty of estimating phase values in the in small amplitude, in the presence of uncertainty. So notice that the power here gets really, really small, relatively. And then that's exactly at the same time point where we have this phase slip, so now the question is, can we really interpret this as a physiological facelift? Was there something biological that was happening in the brain at exactly this time point, at this frequency that caused the phase of the neural oscillation to suddenly shift like this, make this sudden phase shift? Or do we just have a numerical estimation problem here because the power is so low, the amplitude, you know, the the Fourier the wavelet coefficient is so close to the origin that it gets difficult to estimate phase more reliably. So it kind of bounces around a little bit. Now, unfortunately, that is not a question that we can definitively come up with an answer to. However, in this case, I would air on the side of being cautious and say that we probably shouldn't over interpret this little face live here as being physiological, because it occurred at a time when power was relatively very, very small that you also see in the time domain signal here. So in the real part, the filtered signal now that would be a very different story if we also saw a phase slip, let's say, right here where power was relatively larger powers and super high. But, you know, it's larger here. We definitely have something going on, some energy at this frequency. And the signal, if you saw another face slip here, than I would say that is safer to interpret as a physiological effect. OK, so that was a bit of a tangent, but I think it's an important one. All right. So now what we're going to do is view the results as a movie. So I'm just going to let's see. I think all of this coach talks, so I'm just going to run this code immediately and let's see what it looks like. OK, so what you're looking at here is the result of complex wavelet convolution. It's like spiraling around. So this is some chunk of time. You can see it's like getting reset in the center. So it's a snake going through time like this. I'm only plotting I think it's probably one hundred milliseconds. So here you see the complex result of convolution spinning around over time and here you see the amplitude. So this is let's see, where is this? This is the. Yeah. So this is the Amplitude Time series. And now watch what happens when the amplitude gets large. This complex DOT product gets further away from the origin. So now the amplitude is getting larger. It's getting further away from the origin. And sometime around point six, it's going to start getting really large. And then we will see this get very far away as the amplitude decreases, the complex result of convolution gets closer to the origin. So it's spinning closer and closer to the origin. And now sometime soon, it's going to get really large. It's going to explode at this frequency. OK, so here you see, OK, I don't know if you'd call that an explosion, but at least it did get quite large. And you see now for this whole window of time, the amplitude and therefore also the power is really large, which means on the complex plane, the DOT products are really far away from the origin. All right, so that was going a little bit slow for my taste, so I think I'm going to speed up the video a bit in the editing process. You should feel free to play around with this code and you can change the frame rate, for example, by increasing the skipping factor in this for loop here in the next video, I'm going to show you how to implement convolution with all trials, concatenate it together into a super trial. So stay tuned.