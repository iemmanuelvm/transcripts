 This video follows directly from the previous two videos and also relies on variables I created in the previous two videos. So if you are just starting on this video, then you have to go back and run the code from the previous two videos. So in particular, that is the video that's called the section in this code that's called Complex Morleigh Wavelet Convolution, and then the section that's called Convolution with all trials. And then you can start running this Matlab code. OK, so let's get started. So here we define some frequency parameters. So we are going to build up, actually. Let me give you the bird's eye view of what's going to happen in this in this code here. So we initialize this time frequency matrix. You can see it's zeros and then it's the number of frequencies. So number of frequency of thirty by the length of the time vector. And then we are looping over frequencies, create the complex Morleigh wavelet, take its spectrum and notice that we're not taking the spectrum of the data in here. Why not? I'm sure you guessed it correctly. We don't need to. It's actually redundant. It's a waste to compute the spectrum of the data inside this loop over frequencies because the data don't change for the different wavelet frequencies. Of course, the features of the data that we will extract are different for different frequencies, but we don't need to run the 40 transform of the data inside this for loop. In fact, this is even done earlier from the previous video. OK, so then we take the inverse four eight transform of the spectrum of the data and the spectrum of the wavelet clip. The wings reshape back to the size of the data. So two dimensional and then we're going to extract power and average power over trials. OK, so let's go back and go through this line by line. So we are going to build a time frequency plot that goes from five hertz up to 90 hertz in 30 steps. And you can see here these are linearly spaced steps. So the frequencies that we are going to extract, the center frequencies are going to go from five and then the next one is eight and the next one is almost 11. And then up here, it gets to eventually it starts skipping in threes. Oh, yeah. Oh, it's always skipping in threes because these are linearly spaced. Sorry, I'm going to talk in a later video about spacing the frequencies linearly or logarithmically. OK, so now we initialize this time frequency matrix. You can see it's thirty frequencies by fifteen hundred time points. So now let's go through. So I'm going to go through this loop for the first iteration to make sure that all these variables are going to work. And I'm also going to have a look at these things. So E to the I to PI 50 times the Gaussian which is minus four times log two times time squared, divided by point three square. It's the full with the maximum is going to be zero point three seconds. So three hundred milliseconds. And that's actually constant for all frequency. So all frequencies are going to have the exact same full with half maximum. Whether that is a good idea or a bad idea is related to the key parameters of Morleigh Wavelets. And I'm going to talk about that in a couple of videos from now. OK, so then we take the field and Max normalize it here, as I've discussed before. And then here is the rest of convolution. So you can see that I'm not really having separate comments for each individual step of convolution. Some of these things can be simplified a little bit like step three and four, all in one line of code. And here I'm starting to call this variable. Now, as this stands for Analytic Signal, I can write that down analytic signal this term, analytic signal in calculus, it refers to a complex value signal that is differentiable, fully differentiable. Complex value signal is called an analytic signal in calculus and signal processing. People tend to just use the term analytic signal for a complex value time series, typically the result of convolution or any other procedure that you would use in time frequency analysis, including, for example, the filter Hilbert output, which I will talk about later on in this section. OK, so now so we do the inverse for you. Transform the data spectrum times the wavelet spectrum, clip the wings and here we reshape the variable analytic signal from being a vector back into a matrix. So now we want to extract power. So this is the. Analytic signal power, this is going to be the power time series over all of the time points and over all the channels, so there's like a bazillion things that are wrong with this line of code that you can't see. But I'm crying right now. There's so many errors in this code. OK, that's actually not true. I'm not crying. In fact, I even had to pause the video because I started giggling a little bit. So let's see. So instead of angle, we want the magnitude. So that's ABS. And now this variable is actually a yes and not a and we only need to square this result, not raise it to the 20th power. That's totally ridiculous. OK, let's see. So now we got this is still a matrix, but this is a matrix of time by trial. So I'm going to plot time Veck by Aspell and curious to see what this looks like. So it looks like even at this low frequency, this is that five hertz. We still get a bit of a response here, a bit of a spike here. It's also quite interesting to look at these single trials. You can see that this big peak here at around five to seven hundred milliseconds, this is probably going to show up in the trial average, but it's not driven it's not super consistent across all of the trials. So, in fact, there's a lot of trials that have very, very little five hertz power here and a relatively small number of trials that have a larger amount of power and one trial that has really a lot of power at five hertz. So let's see what this thing looks like when we average over trials. Now it looks like this. So it looks like actually this is like three fingers sticking up. OK, so now we are extracting the average power from all the trials and putting that into one column in this matrix for this corresponding frequency. So let's see now. I will run this entire loop and you can see it's pretty fast, that's all. Thanks to the FFE function, the function is really fast and it's also thanks to our understanding of the mechanisms of the convolution. OK, so and then we plot. So this is the, uh, the full time frequency plots and using the contra function. And we are plotting the time vector by the frequency, by the time frequency vector or matrix. And here's what it looks like. So you see the gamma response that we've been looking at before. So in the previous video we looked at forty five hertz and that forty five Hertz responses here. So it's interesting to see actually that the frequency we were looking at in the previous video was not really optimized for this first response. This first gamma response is a bit lower than forty five hertz. And here we do see this forty five hertz. But it's super interesting to see that there's other features in the data that you don't get from only looking at one frequency. So in particular that this gamma response starts off at a higher frequency. It starts off around six years and then it slows down over time, over around, you know, five or six hundred milliseconds. This gamma response slows down and that you don't see this dynamic. You don't see you don't appreciate it when only extracting the power time series from one specific frequency. OK, and then you can also see there's some of this low frequency stuff that we were just looking at before. Cool. Very nice. So I hope you enjoyed this. You can print this out and send it to your grandmother, as I've mentioned before. So what should you do now? Before moving on to the next video? I encourage you to do a few things, experiment around with this code and check out a few different things. One of them is to change this parameter here. This is the width of the Gaussian that that shapes the wavelets. As I mentioned several times, it's going to be a whole video just on this parameter. So don't worry, if you just kind of randomly poking around, then you don't really have a principled understanding of what it's doing. But I think it's still interesting to to explore around what different values of this parameter will have on the the effects on this resulting plot. And then the other thing that I encourage you to explore and play around with is these parameters here. So the minimum frequency, the maximum frequency and the number of frequencies. So I hope you enjoy playing around with this when you are ready. I will see you in the next video.