In this video, you are going to see an FFE applied to a relatively long time series data and also something

called Welches Method, which I introduced in the first video of this section on the background knowledge.

So let's start by loading in some resting state data.

So these were EEG data that were collected while the research participant was just sitting there in

a chair quietly doing nothing, just resting.

So it's always a good idea to start by loading in a data file and looking at the variables.

So we have two variables here.

One, variable EEG data.

And obviously this is going to be the sampling rate.

Let's see what the sampling rate is, OK?

Twenty twenty four hertz.

So these EEG data are one by 120000, so this is one vector that means that it's just one channel.

Now, we actually recorded from many channels, but in this data set, that's just one channel.

Just to make things a bit easier here, I create I see a time vector, so it just goes from one to NP

and then I are actually well, zero to and minus one.

And then I divide by the sampling rate and this basically converts time from indices into seconds,

OK, and then we plot it so we can run this cell and that gives us this plot.

Now this initially looks noisy.

Maybe you think this is just pure noise.

So of course there is some noise in here.

EEG data contains some noise, but we can zoom in.

Let me turn on the zoom.

We can zoom in, for example, you know, just kind of somewhat randomly picking a spot here and it

starts to look a little bit less random when you zoom in so we can zoom in.

I'm going to zoom into this period here.

So this is one second that I'm zooming into.

So 44, second 44 to second 45.

Now you can see that there's some rhythmicity, there's some pattern temporal patterns in the data.

So here you see.

So if you look at these fluctuations, it's like relatively slower frequency fluctuations.

There's one, two, three, four, five, six, seven, eight, nine, 10, 11.

OK, so it starts to break down a little bit here, but we got somewhere around 11 or maybe 12 of these

cycles in this one second period.

So that corresponds to the famous alphabet.

So here you see the al vacillations just visually, but it's also interesting to note that the Alpha

is not constant over time.

So here they're stronger alpha, here there is less alpha.

So already, just by zooming into this one second period, you see that there are some non-state minorities

in the alpha rhythm, and if you zoom in somewhere else, you'll find that in general there's going

to be a lot of alpha anywhere you look.

But you'll find, OK, actually, I don't really see a whole lot of alpha visible here, but you will

find if you go through periods where you find a lot of alpha, it's not always going to be one.

Sometimes it's a little bit slower.

Sometimes it's a little bit faster.

All right.

So these are all non stationary these.

Now, when you have non-state scenarios in the data, it's not necessarily a great idea to do one big

F.T. on the entire time series data, and this is something that I illustrated in the previous video

on the effect of stationary and non stationary simulated data.

Those are somewhat more extreme examples that I showed in that video with simulated data.

But the same concept applies here.

And that concept is that the activity is completely valid for any signal, whether it's rhythmic or

not, whether it's stationary or non stationary.

However, the results of the FFE, the power spectrum of the activity, it's really interpretable or

easily interpretable only when the data are stationary.

So let's run this.

And now here I'm going to.

Perform something called Welches method, and again, I briefly introduce to you the idea of Welches

method in the first video of this section, but it's pretty simple.

It's pretty straightforward.

Welch invented this method in I think it was the early 50s, but I think anyone else would have come

up with this.

You would have come up with this method as well.

It's pretty straightforward.

Basically, the idea is to perform enough of the not on the entire two minutes of data, but instead

you pick a smaller window, let's say one or two seconds, and then you do an FTA on those two seconds

and then you move that one over and another F.T. and another F.T. and so on.

And in the end, you might be doing dozens or maybe hundreds of 50s on small segments of the data.

You extract the power spectrum from each of those segments separately and then you average the power

spectra together.

OK, so in this cell, I compute Welches method manually.

I didn't really know what manual means when you're working on a computer, because I'm not actually

doing this on my own, typing out all the numbers on a on the beach with a stick.

But anyway, so here I define the window length and I'm setting this to be some fraction of the sampling

rate, which means seconds.

So the window length here is going to be one second.

And then here I define the number of points to overlap.

So this is basically how much overlap there is between each successive segment.

And I'm defining this to be one half of the sampling rate, which means one half of a second.

Now, in this particular case, this ends up being an integer, so we don't need to round it.

But sometimes it's good to make your code be a little bit more general so that if you have a sampling

rate of, you know, one thousand twenty three hertz, which is a bit of an unusual sampling rate,

but whatever.

So if you have a sampling rate, that's not an even number, then you want this to be an even number.

OK, so based on this and this parameter, we can find the window on set, so this is the points of

time at which the window starts.

So let me run some of this so you can see that the window is going to start at each of these points.

So it's going to be this time point, this time index and then from here up to this time index plus

window length, which is one second, and then the next one is going to be here plus one length and

so forth.

OK, so here I define the vector of frequencies, and you have to be careful here that you're specifying

the end of the 50 correctly, this is not the length of the data.

This is not one hundred and twenty seconds.

This is actually just the window length.

Here I create a Hohn window.

Let me show you what this hand window looks like.

It's plot on W so it looks a little bit like a Gaussian.

It starts at zero or very close to zero and ends very close to zero and it peaks at one in the middle.

And this is going to be the tapering function that we use to attenuate the activity at the edges.

I'll show you that in a minute.

OK, here I initialize the matrix and actually this is not correct.

This is windows by frequency.

But actually what I'm going to do is take this variable and keep adding it to itself.

And then I divide by the number of windows.

You could make this to be windows by frequencies.

That would be useful if you wanted to see how the power is changing over time.

And in fact, that basically just gives you a time frequency analysis, which you will learn much more

about in the next section of this course.

All right.

So here is the main loop for Welches method.

So we extract a chunk of the data.

So this is a segment of the data.

You can see it's the data and it starts from the window on set, the WUIS element in window on set,

and it goes to that window on set, plus the window length, exactly as I described.

So now let's start here.

Let's get out a chunk of data, so I'm going to plot this chunk of data, this Epicor data data chunk.

So here you see a bit of data now, you can already see that there's edges, there's edges here, there's

definitely a big edge here and it's probably also as linear.

There might be a linear trend, but at least it goes up towards the end.

So this is going to result in non stationary D that will make the effort require more energy, non-zero

energy at frequencies that we are not really interested in.

So that is the reason for tapering the data point by multiplying the data chunk by the hand window.

So run this and I'll type hold on and then plot this again in red.

And now you can see all the information in the middle has preserved and it gets attenuated and now we

get no edge effects.

Now, you're probably concerned here, because this is valid data, this is valid data, and why are

we attenuating valid data?

Well, that is the entire motivation to have overlapping windows.

So we have overlapping windows that start from one half of the sampling rate, which means that this

is one window.

The next window actually starts here at 512 milliseconds and we'll go out here.

So that means in the next time window, this region is going to be attenuated and this region here is

going to be the middle of the hand window, which means that we will not actually lose this information.

It just gets shifted into the next time at the next window.

All right, then we extract the magnitude and then square to get power, and then again, just adding

that onto this variable so this accumulates, it gets bigger and bigger and then we divide by and.

All right.

Now, let's take a look at the results here.

You see the power spectra from both the static.

And I think I'm missing a, uh, in parenthesis here.

So what I call the static FFG, that's one 50 over the entire two seconds are two minute window and

the result of Welch's method.

So it's interesting to compare these.

You can see that overall the shape is quite similar.

You still see this peak in Alpha, you still see this one over decline here.

But the static FFG has a lot more.

That looks like noise, you know, looks like probably something you would want to smooth out.

Part of this is due to the non-state charities and also part of this is just due to the increased spectral

resolution.

Because of the increase in the number of time points.

All right, so then the last thing I want to show you is this function is Matlab function plus.

This is in the signal processing toolbox, so you would need the signal processing toolbox to run this

function, but basically this is one function that's also going to produce this result for us.

So you input the data and then other parameters are optional, but you can specify the window to use

for tapering the amount of overlap in here.

I'm actually doing a quarter of the sampling right now, so this is still half a second because I'm

taking the window size to be two seconds and then the sampling rate.

So that looks like this.

And here you see now this is normalized using a decibel scale.

So this is not exactly going to be comparable here because this is not normalized.

This is the raw power and this is normalized power.

But the important thing is the shape of the spectrum.

And actually this is also plotted in log units.

But still, you see the general one over Efterklang and you see a robust peak here at Alpha.

So the important features are preserved between these methods.