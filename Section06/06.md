 Tapering is a pre processing step that is often recommended in spectral analyses, and before getting further in this video, I want to just quickly show you what tapering means, what it means to taper a time series signal. And then the rest of this video is partly to show you how to taper and partly to ask the question of whether you really need to taper and when you need to taper. What are the implications of tapering for the power spectrum? All right. So here is a time serious signal in blue. This is the original time, serious signal. Now, in this case, that just happens to be just a noise signal. But that's OK. And now overlaid in orange is the tapered version of that signal. So you can see that it looks really, really similar to the original signal in the middle. And then it kind of clips down to zero. It sort of attenuates down to zero in the beginning and at the end. Now, this is called tapering. And when you can imagine is that there is a Gaussian or some other function, but kind of like a Gaussian that starts off at zero and it increases to one and then it decreases down to zero. And that tapering function or window is multiplying element wise, multiplying the original blue signal, and that gives the orange signal. Now, the idea of tapering is that it attenuates the edge effects and that improves the quality of the power spectrum from the four year transformer. OK, so that's the theory. Now, what I like to do is dive in and show you the effects of tapering. So first, I'm going to start by creating some tapers and I'll show you three different tapers. So we'll compare one window, a Gaussian window and a Heming window. Now, sometimes this is actually called a Hanning window made, right, that sometimes people call this a hanging. But that is technically not correct because the guy who came up with this tape or his name was hung like this. And that's different from the person who came up with the hamming window. And his name actually was Heming. So the correct terminology is a Hunter paper and a Heming paper and then Gousse paper, of course, is named after Gousse. So here's the formula. I'm not going to walk through in too much detail. Basically, they're all based on cosigns. So this is a cosine this is a cosigns just some slightly different ways of parameter ising it. And of course, the Gaussian is an exponential, but you could also express that as cosigns in signs. Now you might recognize that here I'm not dividing by anything. So typically the Gaussian form is E to the minus T squared over and then it should be over, you know, s or some other parameter. In this case, I'm taking the time vector and I'm centering it. So it's centered at zero and then I'm dividing by the standard deviation. So basically just scaling this down. So this ends up being effectively a Z score. And that is just a little trick that saves me any effort of having to specify a denominator in the exponential here for the Gaussian. All right. So I create those three papers and then I plot them. And by the way, there are other papers. These are not the only three, but I think these are the main three that are most often used for tapering in spectral analysis. Here you see a comparison of them. Notice that the hand window is the only one that touches zero or at least gets really, really close to zero. These other ones are a little bit further. Now, I could get these to be closer to zero by extending this to be longer. So basically, if you look at the time vector go out longer, let's say to, you know, somewhere around two and a half or maybe three, then these functions would also get increasingly close to zero. But you can see they all have roughly the same form as they all kind of, you know, come down to small numbers and go up to one and then come back down to small numbers. Now, what I'm going to do is set the y axis to be logarithmically scaled, and that just kind of highlights the differences between these. Three tapering windows, particularly at the outer edges, so you see that the huhn window provides the most amount of attenuation, the most amount of suppression here at the edges and towards the middle. They all look more or less the same. This is the reason why whenever I am applying a taper, I tend to use a hand window, but I think in practice you're not really going to find real differences between these. So I think any of these tapers is OK. All right. So now what I'm going to do is show you some data before and after a tapering window is applied. So we generate some random numbers and then just element wise, multiplied by these three different tapers and then plots. And it's pretty straightforward. In fact, this is the plot that I showed you in the beginning of the slide. And again, when you look qualitatively, you really don't see any differences between the effects of tapering with the hand Heming or Gaussian window. Of course, the difference between tapering and not tapering is very clear, that's a big difference. You'll see that also in the power sector, but the three different tapers really don't really different that much from each other in practice. All right. Now I compute the power spectra. So at 50 and then I extract the magnitude and square it of the original data and then with these different tapers. Now, you might notice that I'm not dividing by any I'm not multiplying by two, so this is not power spectra that are in the true units of the units in this plot. Let me show this. So these units are not all correct. But in this case, and also quite often, even in practice, you don't need to care about the units, what you care about is the shape of the power spectrum and you want to be able to compare different results against each other. So in this case, because I haven't applied any normalization to any of these four year spectra, then the units are not accurate, but they're equally not accurate for all four of these spectra. OK, so what you see is that one of these things is not like the other. And what is not like the others is this non-paper, which means just the raw original data. And again, these other three tapers, they look slightly different. You will be able to find some subtle differences. But they those are not real qualitative differences. So, again, I think the point is there's a big difference between tapering or not tapering. But as for which tapering function to use, it doesn't really make much of a difference. Now, the reason why these are so much different is that when you are tapering, you are actually losing valid signal and that you see here. So there's nothing wrong with this signal here and there's nothing wrong with this signal here. This is totally valid signal, but we are attenuating it. We are losing it in the tapering. And so that causes the difference, that signal loss causes the difference between the tapering spectra and the original spectrum. That said, you can see that they look quite similar, if you would, in particular, if you would scale down the the non-paper. So the original data, if you would scale this down, you would see that they look even more similar. In fact, maybe I'll even try that. So let's see. Let's just try dividing by three and see how that looks. OK, so now you see that the maybe I'll even try it. Let's see, four might be too much. Oh this is good actually. So once this original power spectrum was scaled down, now you see that the overall shapes of the spectra are really similar. Again, not identical, of course, really similar. In fact, the tapered versions basically just look like a smoothed version of the original power spectrum. There's one other thing that I would like to point out is more about MATLAB programming and about neural data analysis. And that is that here, rather than specifying optional inputs into the plot function that are identical for all four of these plots, instead, I've just requested Hendel. So I have this vector H. This is a vector of line handles and then I update all four of them at the same time to have a line width of two, a marker size of ten and a marker face color of white. Now I think this is a useful way to do it because imagine if you wanted to try changing this. So for example, when I run this on my laptop, my laptop has a ludicrously high screen resolution, a bit too high. So I tend to turn the line with up and I make the marker size a bit larger. Now, if I had to do this four times, that would be a little more annoying. And here I only have to change the parameter once, and it's applied equally to all four of these lines. All right. So that's just a little plodding trick. The next thing I would like to show you is what happens if we add a non stationary to an otherwise stationary signal? So what I'm going to do is generate a new data set. And this is just a sine wave that goes from zero to 20 PI. So just a bunch of cycles at some frequency that's kind of arbitrary. And then I add a non stationary, so I just add a a line that goes from minus one to plus two. Then the rest of this code is the same. So here you see what it looks like. The blue is the original signal. That's the same. And all three of these panels. And then this orange line shows the result of tapering. Again, the tapered results all look really, really similar to each other and roughly equally different from the original signal. All right, then. Here we get the power spectra again. This code is all the same as the code earlier, so I won't really talk much about it. And I think I will also scale this down. Wonderfalls also good factor here, or maybe three. I want this to be a little bit higher. OK, so again, you can see that with and without the tapering, the power spectra look quite similar. But there are a few noteworthy differences. So one thing is that this red line here, so without any tapering, it looks like it's it has a correct shape. But this is a little bit misleading because of this line. This is really flat here and here. And there's only one peak. There's one spike at point zero, five frequency. Now, normally, lines are not really technically appropriate for plotting a power spectrum. Really, this should be done with STEM plots or with bars, because the line kind of implies that we know that the frequency at this location, this frequency, would have this power, which is actually not true. We have no idea. We weren't able to measure the signal at this point. This is a bit of a subtle feature of the four year transform. But in fact, we don't know what is going on in the signal at this exact frequency. So the line itself is a little bit misleading. On the other hand, if you want to show multiple power spectra on top of each other in the same graph, you really have no other option than to use lines like this. OK, but anyway, the thing that I wanted to point out is that with the tapers, then you do actually get additional points here. So this peak at point zero five frequency, this is now less picky with the windowed versions compared to the original versions. And you can see why when you look at the time domain plot. So essentially I have added I've introduced new non stationary things into the signal I've introduced in amplitude non stationary in the signal that wasn't actually there, and that was because of the tapering. So you got a little bit of extra non stationary. On the other hand, when you look at the power spectrum here at the lower end, you can see that the tapered signals actually have less of this non stationary here. And I think I will show this in the correct relative amplitudes. So all of this. Business here, this is a non stationary that's introduced by this line, by this linear shift from minus one up to plus two, and so that non stationary is causing this big increase here, this sort of, you know, almost one over F looking slope down here. And that is almost entirely eliminated by the various tapers. So this part of the spectrum is cleaner. This part of the spectrum is a little bit smoother. So, you know, it's a bit of a tradeoff here. I think some of the non stationary things look better and some of the non stationary is look a bit worse with tapering compared to no tapering. So finally, I want to illustrate this in real data and one of the points. Let me first run all this code and I'll walk you through the grass. So one of the difficulties of tapering, or I should say one of the disadvantages of tapering is that, as I mentioned before, you are losing valid signals. So this is a valid signal here and here that's being cut off. So when you have a longer time series, what you would want to do is cut the data. So epic the data into relatively small chunks of time, let's say maybe one or two or three seconds. And then you you taper each individual epic and extract power from that epic. Now, that's called Welches method. And of course, you are now experts on Welches method after the other videos in this section. And one of the ways of dealing with the signal loss from tapering is moving these sliding windows with overlap. So what you see here is the black line is the first window, the first apoc of this data set, and that is two seconds long. And then red is the tapered version. So red is the signal that we are going to compute the four transform of and extract the power spectrum from. And now the idea is that you're losing valid signal here. So what you do is the second and apoc. Starts here in the middle of the first apoc, so now you see so this blue line here is actually the same as the black line here, but it's shifted. So now the epic goes for the. And what you see is that the area of the data set that was tapered, that was suppressed from the taper in the first apoc, that's actually highlighted in the second APOC. And here this is the part of the signal, the middle of the first back that was attenuated in the first step. And now I'm sorry, maximised in the first step and now it's attenuated in the second. OK, you can see this stuff gets a bit confusing to talk about, but I think you get the idea here. Now, in this graph, you can see the power spectra with no tapering and with applying a hand taper, and again, it's all the same thing. And I think I'm also going to divide this, let's say, divide by two, maybe just to make them be a little bit more comparable, maybe divide by two point five. Yeah, this looks good. So now you see that there is this overall scaling effect and that's not surprising. We are attenuating a lot of the signals. So the power spectrum is going to decrease. But when you look at most of the features of this power spectrum, are these two power spectra, they look really similar to each other. The two primary differences are that the very narrow peaks become a little bit smoothed out from the tapering. Again, this is a result of introducing non-state scenarios that weren't actually present in the signal, the original signal. And the second thing is that a lot of these lower frequency. Effects due to non stationary that were present in single mostly effects, these effects are now attenuated, but a lot of the features in the power spectrum are otherwise relatively unchanged or maybe a little bit smoother. So now let me go back to the question in the title of this video to taper or not to taper. To be honest, I am not so convinced that tapering is always necessary. It's often written in textbooks. I believe that I wrote it myself as well. But when you actually sit down and look at the results with or without the tapering, you very often find that it doesn't really make much of a difference qualitatively other than overall reducing the entire spectrum.