In this video, we are going to explore the effects of averaging on the power spectra of moulted trial

time series data, and in particular, what we're going to do is compute the power spectrum of data

on each trial separately and then average the power spectra across each individual trial or first average

all the trials in the time domain and then compute the one power spectrum of the trial average.

So let me make some plots that I'll make what I'm explaining a little bit more clear.

So Melodia, in this data set, V1 Laminar, we've worked with this data set before.

I'm going to use Channel seven for convenience and here I'm going to plot all of the trials so you can

see I'm plotting the CSI.

That's the main variable inside this math file that contains the data from this channel and from all

the time points and all trials.

And then on top of that, I'm going to plot the ERP.

So the average over all of the trials, the third dimension.

OK, so here you see what that looks like.

All the individual trials, there were two hundred I believe.

Yeah.

So all individual 200 trials are in grey and then in black you see the average.

Now clearly there is reproducible, there's reliable patterns that exist on every trial and that's why

you see an ERP.

But you can also see that the ERP is quite a bit smaller in magnitude compared to the single trial variability,

single trial fluctuations.

In fact, the ERP, the trial average is around one order of magnitude smaller than the single trial

variability.

So now the question is, what is the power spectrum like on the individual trials and what is the power

spectrum like on the trial average?

So that's what we are going to do below.

In the code below, we're going to compute the Fourier transform and extract the power spectrum from

each individual trial versus just extracting it from the ERP.

Furthermore, we're also going to compute before you transform in a time window, so not just one FFE

over this entire time region, you can see there's a lot of fluctuations, there's a lot of different

dynamics.

And so it's reasonable to expect that the spectral characteristics of the data will look different here

in this time window versus this time window versus this time window.

So we are going to select just a specific time window.

In this case.

I'm starting off with the time window zero point five, which corresponds to this time window here.

So basically this stuff here and then later when I show you the code, then will change the time window

to this and you will see how much different the spectrum looks here versus here.

Here I am specifying the spectral resolution.

So I want the results, I want the power spectrum to have a spectral resolution of zero point five hertz.

That means that the frequencies that I want to get out of the four transform should be zero point five

hertz, one hertz, one point five hertz, two hertz and so on.

So this is the formula for computing the end of the F.T. So basically, how many points do we need to

include in the FFE in order to get a spectral resolution of this of zero point five?

OK, so here is the two lines of code where I'm getting the fifty of all the trials individually and

then averaging the amplitude spectrum.

I said power spectrum before, but I guess I'm comparing the amplitude spectrum, although that doesn't

matter in many, many cases.

In this course what matters is the shape of the spectrum, not so much whether it's normalized or not

normalized or amplitude or power.

Anyway, so this is a rather long line of code, but it's actually not so bad.

So we're taking the effort of the data and here the data.

So it's the CSD Matrix, it's this channel, all of the trials, and then it's this time window so restricted

in this time window.

And then this turns out to be a three dimensional matrix is still a cube.

This is a singleton dimension.

There's only one element on this dimension, but it's still technically a cube of data so that I'm squeezing

it into a two dimensional matrix of data.

And here I specify the end of the FFE.

And now I realize that I've mentioned previously that any time you're inputting a matrix as opposed

to a vector into the affected function, it's always a good idea to explicitly specify the dimensions

along which you want to compute the Fourier transform.

So we want to compute the for you transform over time.

So that's the first dimension.

It's a little bit confusing because in this matrix, time is actually a second dimension.

But after we squeeze it, actually let me show you this and make that a little bit more clear.

So I'm going to say the size of this.

So that's three dimensional.

And then if I squeeze.

That's going to get rid of this Singleton dimension, so this goes from a three dimensional matrix and

it's squeezed down into a two dimensional matrix.

So, again, this time by trials.

So this is the direct output of the 50 functions.

These are the four year coefficients.

And let me run this so you can see what it looks like.

So this is also two dimensional.

This is now 1500 by 200, so there are 200 trials and fifteen hundred twenty six frequencies.

Now that may initially seem weird because there's three hundred and eighty three time points.

But remember that we're using a large and 15 now.

These are the complex Fourier coefficients.

So here I'm extracting the magnitude, multiplying it by two to give me amplitude.

And then I'm averaging over the second dimension, which of course is trials.

So this is the 15th of each trial individually.

You can do this in a loop if you prefer, but you can also do it as a matrix operation and then averaging

the amplitude spectrum over all of those individual trials.

And here I say, note that we can do it all in one line so you can actually put this all in one line.

It ends up being, you know, like this.

And that's just a really, really long line of code.

And sometimes if I'm feeling particularly mean as a teacher, I will write a line of code like this

just to confuse the students.

But I think in this case, I'm feeling a bit nice this morning.

So.

So now it's broken up into two lines.

OK, so that's for the fifth year of each trial individually here is for 150 of the average of all the

trials.

Now you can see this part is kind of the same.

So it's still the CCDs matrix for this channel, this time window and all the trials, except now I'm

already averaging over all the trials.

So that means that what's going into the FFE function is not a matrix, it's a single vector.

Let me show you this.

I can say size.

So this is not there's no two hundred in here.

This is just a tiny vector.

And then here I extract magnitude and of course, you could also do this on one line if you like, like

this.

OK, then I got the vector of frequencies and then basically just plotting them on top of each other.

So here you see the results and it's quite striking how much they differ.

So the blue line is the average power spectrum from computing the power spectrum of each trial separately.

And then the red line is the power spectrum of the average, the trial average.

And actually the legend is a little bit confusing because it's not the me and the 50 is the mean of

the data.

But anyway.

So the difference between these two power spectra is similar to the difference between the gray lines

here and the black lines.

So essentially this is kind of hard to interpret.

You don't know if you know, all the extra amplitude in the single trials is really due to more information

in the signal or if it's really just due to more noise.

So you see that there is this broadband shift.

So across all or nearly all frequencies, there's this broadband increase in the spectrum that is reflecting

the general increase in broadband energy.

However, you do see that this peak around 40 hertz, a little bit higher than 40 hertz.

This is much more prominent in the single trial data than it is in the trial average.

There is still a little bit of a peak here in the trial average, but it's way more prominent here in

the single trial data.

So this indicates that there is a lot of information.

There's meaningful oscillatory information in these single trials in the gray lines that is not present.

It gets averaged out.

It's washed away in the trial average.

And the reason why that happens is that the exact timing can differ from trial to trial.

So that's, again, a non phase locked oscillation, which you learned about in the beginning of this

course in the section on simulated data.

So phase locked versus non phase locked activity.

So basically, when you see this big difference in the power spectrum for the single trial power spectrum

versus the trial average power spectrum, that is attributable to non phase locked activity.

All right.

So that's already pretty interesting.

Now, I would like to run this again using a different windows.

And I'm going to say from point five seconds to one second and let me put this into figure three.

That's useful.

That will allow us to compare the results between the first time window and the second time window.

So here you see those results here.

And it's interesting to go back and forth and compare these two.

So one thing you see is that the frequency is higher.

So here the frequency peaks at around 50 hertz.

There's also multiple peaks.

Here is another peak here at a little below 60 hertz.

And here the peak was at 40 hertz.

And that's really the only peak.

Maybe there's also a little bit of a suggestion of a peak here.

Another noteworthy difference is that here in this first time window, the power spectrum was basically

just one over after, you know, maybe a little bit of a suggestion of some phase locked oscillations

here.

But here you see in the power spectrum.

So there is one over F, of course, but you also see is much more prominent peak at around 50 hertz

in the trial average.

And of course, it's even more prominent in the single trial data.

And this here, this peak here that you can see in the time domain that these wiggles here, these ripples.

So which one is correct and which one is wrong?

Obviously, it's a bit of a trick question.

Both of these methods are correct.

They're both perfectly valid ways of looking at data, but they tell you very different things about

the data.

And that is really prominent when you look here.

So this plot tells you that in this first time window, there is a strong 40 Hertz response, but the

timing is jittered from trial to trial.

So it averages out in the ERP.