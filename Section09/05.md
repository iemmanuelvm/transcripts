I hope I convince you in the previous video that the formula for the math underlying interstate phase

clustering or the dominant measure of phase synchronization for measuring connectivity in electrophysiology

data is not so difficult.

So let's implement it in practice.

What we are going to do is explore the mechanism of phase synchronization, and we're going to do that

from the V1 data set using these two channels.

And essentially what we are going to do is compute synchronization at eight hertz between Channel one

and Channel eight, and that actually corresponds to the hippocampus and the layer for a little bit

above layer four in the end V1.

So let's see here.

We created a complex Morleigh wavelet.

We didn't get any matlab errors done here.

And we got a little reminder, which is always good.

Don't forget to plot the wavelet, so let's plot the wavelet.

So I'm going to plot time by the real part of the wavelets and let's see what this looks like.

Oh, it looks a little bit strange.

Why does it look strange?

Well, it is centered at zero, so that part is legit.

But this is a huge offset here.

Now, when we use this in convolution Matlab is not going to know that time zero is all the way down

here.

In fact, Matlab is just going to see it like this.

And here is the center of the wavelet, you know.

Well, this is the center of the kernel, I should say.

So that means we are going to be introducing a huge phase shift in the results.

It's going to be a phase shift of like 13 seconds.

So let's set this back to something a little bit more reasonable.

And, uh, let's now recreate this wavelet.

And so let's do the plotting again.

All right.

So this looks better.

Now we can see that the wavelet is definitely plausibly centered.

OK, so let's keep going on.

So the FFT parameters, we have the length of time, the length of the number of time points.

There's also the length of time.

But this is the time vector for the wavelet.

This is the time vector for the data.

And now we have to look forward to see if we're supposed to be doing the convolution from all trials

or just one trial.

It actually doesn't say, let me see.

I oh, it does say it says trial one.

OK, so then in fact, this is correct.

And data is just the number of time points because we are only running convolution for a single trial

and then we have this formula for the length of the result of convolution.

That seems correct.

All right.

So then we take the OK, this is wrong.

This should be this is going to be used.

This is a spectrum of the wavelet that will be used in convolution to multiply the data spectrum.

So this actually needs to be an conv points.

But this stuff gets tricky, doesn't it?

Let's see.

So then I'm also going to have a look at this just to make sure.

So plot ABS Wavelet X and I expect this to be a Gaussian, which it is.

OK, very good.

And remember, this is not frequency, this is not forty hertz.

This is frequency index because I didn't create a hertz vector.

OK, let's see.

So now we need to initialize the output time frequency data.

Now I have no idea what this is, you know what the size of this thing is supposed to be.

So what I'm going to do is look down below in the code and see if I can figure out what the size needs

to be based on how this variable gets used.

So here we say phase data, one, comma all.

So this already tells me that we're going to need a two dimensional matrix here.

And this is going to be so the first element of the first dimension and all elements, the second dimension

are going to be the phase angle time series from the result of convolution.

So let's see.

Let's keep looking them.

OK, so we have phase data one and then phase data two.

So basically what this is telling me is that phase data is supposed to be a two by length time VEC matrix.

So this is to buy time and the two is going to be for the two channels.

So Channel one and Channel eight and then this, the real data is going to be the same.

OK, very good.

Now we obtain the analytic signal of Channel One from trial one.

So that is the effort of CSC data.

And this was Channel one.

IDEX all the time points the first trial.

And is this correct like this?

No, it is not correct.

Well, I mean, it's not.

It's not.

Going to give a Matlab error, but it's the wrong thing to do in terms of signal processing, and that's

because we need the Encarna point, F.T. So this ends up being not fifteen hundred and twenty seven,

but three thousand eight hundred and fifteen.

OK, and then here is the meat of convolution.

So we multiply the spectrum of the data by the spectrum of the wavelet, take the inverse for a transform,

cut off the wings of convolution.

And then we can do this.

We can collect our phase data and the real part of the data.

And I'm curious to see what these look like.

I'm going to say plot time back and phase data.

And now we got one normal looking phase angle time series and one flat line.

Is that correct or is that a mistake?

Yeah, it's correct because we initialized phase data to be zeros and we haven't yet to find the second

phase angle time series from the second channel.

And not just out of curiosity, I would also like to see what the real part of the signal looks like.

So here you see the real part of the signal from eight hertz from this one particular channel.

All right.

Very good.

So now the analytic signal of Channel one, I think this is supposed to say Channel eight, a little

copy paste typo.

You always have to be careful.

Please copy paste.

Typos is the most common source of mistakes.

I think in coding in general, you copy and paste something and then you forget to change the name of

a variable.

Those are dangerous mistakes because Matlab will often not produce any explicit errors because you didn't

actually do anything wrong in terms of the actual raw code.

OK, anyway, let's see, the rest of this seems OK and OK.

Oh -- man that's a little embarrassing because up here I asked you whether this was correct and I

assume he said no, it wasn't correct and now I made that same mistake.

OK, anyway, now I would like to plot these guys again, just out of curiosity.

So now we see the real part of the signal from two channels and here we see the phase angle time series

from the two channels.

And that's pretty interesting.

You can see here after time zero, they look like they're really strongly phase synchronized.

And here it looks like they get a little bit out of sync here around half a second.

All right.

And so now essentially, we are setting up a figure to run an animation.

And it's going to be an animation that illustrates the pictures, the still pictures that I showed in

the previous video.

So this cell is just setting up the figure.

You can run it and move on.

OK, so let us just run all of this code here.

And this is interesting.

You cannot set the read only property number of figure.

Let's see where this is going wrong.

That's actually all the way back up here at the top.

So it looks like we generate a figure, which we already have that figure here, and we want to set

some properties of the figure.

So set, get current figure and then these come in property value pairs.

So no off.

This is the no figure one and then the name is going to be movie magic minimizes the magic.

So let's see, this is telling us that the property number is not something is read only it's not something

that we can actually set.

Now we could just delete this here so I could just write like this and you'll see that that sets the

title of this figure, but it still has figure one.

So what if we wanted this figure just to say movie magic minimizes the magic without having this text

here, figure one.

Well, let's try looking at what the various properties are.

So I'm going to write get that current figure and this is going to give me a whole list of all the properties

of this figure object that I can change.

And let's see if we can see a property that seems like it might be relevant for us to change.

Now, I was trying to change.

This number is set to one.

So this is the property and the value is set to one.

However, if we look immediately below, there is another one called number title and the current setting

it's currently set to be on.

So I'm going to try changing that.

So let's do a little undo.

So no title and then let's set that one to off.

Hmm.

OK, that looks really nice.

Now we've gotten rid of that pesky little label that says figure one.

OK, now this was, you know, just kind of a cute little thing.

But the fact that we took off the figure here didn't matter so much.

But what I wanted to you, the reason why I put that air in there was.

I wanted to use that as an excuse to illustrate to you how you can go about finding properties of figures

and axes that you can change, and this is basically one way to do it is say get and then the figure

object, get current figure or get current access if you're trying to change an axis or any other handles

for plot objects.

All right.

That aside, now we get this figure window here.

So what we're going to do here, actually, let me just I'll just run all this code and you can see

what what it's doing.

All right.

So let's see.

So here we see an animation over here.

You see the two filtered signals.

So Channel one and Channel eight filtered at eight hertz.

Here you see they're facing all time series.

What you see here is the phase angles from each of the two channels independently plotted on this circle

in this complex plane here.

Now, no surprise, they are uniformly distributed.

We're going through many, many cycles.

So, of course, these things are all over the place.

And then what you see here is the phase angle differences.

And you see those are really tightly clustered.

They were initially all really tightly clustered here.

Now, it's interesting to see this is that time window we discussed earlier where these these two electrodes

seem to get a little bit out of phase.

They get a little bit out of sync with each other.

And now you see that the this distribution of the phase angles is getting a little bit wider.

It's getting more distributed.

Apologies for my somewhat raspy voice.

By the way, I've been a bit sick the past few days, but, you know, I've got to keep doing these

recordings anyway.

So now what we are doing is quantifying phase synchronization between these two channels.

So we are going to do this over four steps here.

So first, let's do the phase angle differences.

So that is that variable is called phase data.

Yeah.

So this is phase data and then the first channel minus phase data from the second channel.

So here we have the phase angle differences and then we want to oilrigs them or make complex factors

with unit length where the phase is defined.

The phase of each vector is defined by this variable here.

So that is E to the AI times phase angle differences.

And then you can see that like with the previous like what I explained in the previous video, this

is all really similar to ITC, except we have phase angle differences instead of the raw phase angles

themselves.

OK, then we want the average of these vectors.

So remember that these are just, you know, sort of regular radians.

These are real value numbers.

These are complex numbers because they reflect angles or vectors in the complex plane.

And now we want to get the average of these I mean, of oilor phase differences.

And this is going to be a single number corresponding to one individual angle.

That's the average of the angles.

And then we get the length of that line and that is the abs of mean complex vector.

And then we see drumroll, please, the phase synchronization between Channel One and Channel eight

across the entire time window.

Here is point eight five essentially.

And that's not really surprising.

You can see that these phase angles are all pretty tightly distributed or tightly clustered into this

one pocket, this one, you know, kind of quarter or so of of the circle, OK?

And now here we are going to do this again.

I just want to, you know, write this out all on one line, because in practice, you don't want to

have to spend all of this real estate just to compute phase synchronization.

So what we're going to do here is just rewrite all of this stuff in one line of code.

So I'm going to work my way from the inside to the outside.

So the inside of this formula was phase data.

And actually we can even compute the difference of the phase data.

So that's equivalent to saying phase data two minus phase data one.

And then I need to confirm that this is actually giving us the right size.

Yeah, it is giving us the right size.

And I wanted to confirm that because if you compute the difference so the discrete derivative, you

have to make sure that you're doing it over the correct dimensions.

So, for example, if you would do it over the second dimension, oops, that's not not what I meant

to do this.

So you can compute the difference over the second dimension, and that's actually giving you the temporal

derivative for each channel separately.

What we want is the well, it's not really the derivative per say, but it's the difference between

Channel two and Channel one for each time point.

OK, so that's why I needed to check the sizes there.

All right.

So that gives us the difference, the phase angle differences.

And then we need to put those push that through Euler's formula like this, and then we compute the

average of all of these vectors like this.

And then the final step is to take the magnitude like this.

So you can see that in practice, it's much better to have this one line of code than all of this stuff.

OK, and then we can also confirm that this was yeah, it was like point eight, four six when we did

it this way and point eight four six when we do it this way.

So no big surprise.

OK, here, what I want to illustrate to you is that the order of subtraction is meaningless.

That means that this measure of phase synchronization is non directional.

So we cannot infer directionality.

So whether Channel eight leads Channel one or one leads Channel eight from this measure on its own.

And so to do that when I'm going to do is actually just add a minus sign here.

And the idea is that, you know, this, uh, wait a minute.

Sorry to be like this.

Yeah.

So this is computing the difference between so this is computing channel to minus Channel one, and

here I'm doing Channel two minus Channel one times minus one.

So that's the same thing.

And saying Channel one minus Channel two.

OK, and then you see we get exactly the same answer.

So it's a symmetric measure of synchronization.

All right.

And then the last thing that we're going to do here is just plot the average vector on here.

So here you see the average vector.

And essentially the way that I did this plot, the way that I drew this line is by computing.

So taking this mean complex vector.

And normally what we want to interpret is the magnitude of that complex vector.

But we can also get the preferred phase angle by extracting the angle of that complex vector.

And that points over here.