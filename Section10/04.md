 In the previous video, you learned about creating a channel by channel synchronization matrices, and then we also explored a kind of qualitatively a bit poking around what the matrices looked like for different frequencies. In this video, there's going to be a couple of editions. First of all, we're going to be looking at connectivity measured through power time series correlations instead of phase synchronization. So we're looking for fluctuations in power time courses across different channels over time. And secondly, you will also see a little bit better how to quantify the all to all connectivity profiles over different frequencies. So I'll show you that and graphs. And I will also show you how to make an animation of visualizing the changes in connectivity over a frequency. All right. So let's get started. Load in the same V1 laminar data set. Now I'm going to specify a range of frequencies will go from 10 to 80 hertz. And these will define the center frequencies. And we need the same frequency domain Gaussian filter that I used in the previous video. So this specifies the peak frequencies and the width of the frequencies will increase from five to 10 hertz. With increasing frequency. Here, I specify a time window for the analysis, so I'm going to compute the power time series correlations between zero seconds and one second, and that corresponds to stimulus on and stimulus off. Now, there's also a change in the stimulus at point five seconds, and I'm ignoring that here. So if you'd like, you could also separate this analysis for zero point five and point five to one. But for now, for simplicity, I'm just including the entire stimulus presentation period here. I initialize the correlation matrix so you can see it's going to be a matrix. It'll be a three dimensional matrix. It's going to be frequency's by channels. By channels. All right. So let me loading these data. Here we have a big cell that does the analysis, so we start with a loop over frequencies and before going through line by line, let's kind of take a bird's eye view of what's happening inside this for Loop. So here I extract the Amplitude Time series and then here I run the correlation and you can see it's done in a loop over all of the trials. All right. So let's see how this works. So I'm going to set the looping index to be one, and that's going to allow me to run through this line by line. So some data, this is like super data. And basically what I'm doing is reshaping the data. Remember, this starts off as three dimensional. So channels by time, by trials. And I'm reshaping it into channels by empty, which means channels by everything that's left, which is time by trials. So now we got this big matrix of 16 by three hundred thousand. Here I apply the filter. So this is also going to be 16 by 300000. But now this is Narrabeen filtered at, let's see, around ten hertz, whereas this is the broadband data super data. Now I extract the power data. I call this the amplitude time series. I guess it'd probably be a bit more accurate to call this AMP that instead of that. But it doesn't matter. So it's the magnitude of the Hilbert transform of the narrowband filtered data. And now you can see I have this somewhat awkward double transpose here. This is a transpose here. And then this is also forcing Matlab to compute the regular transpose as opposed to the complex conjugate transpose or the commission transpose, which is just a single apostrophe. So the reason why we can use the information transpose here is that F that is only real value. So the complex conjugate of a real value, that number is exactly that same number, because when you flip the sign of the imaginary component and the imaginary component zero, obviously that does nothing. So here, if you like, you can put a period, but that doesn't actually matter here. It does matter. And you saw in the previous video on phase synchronization matrices that that has some pretty significant implications. So make sure you get this transposition business right. And as I mentioned in the previous video, if you're ever unsure whether you are applying the Hilbert transform correctly to Matrix input, the right thing to do is to plot the angles, the phase angle time series and make sure that it looks kind of exactly how you would expect. And in fact, you know, that is such an important point. I think I will even show you that quickly. So let's see. I'm going to copy and say let's call this P equals, uh, held at an angle. I just extract the angles right away and now I'm going to see what he looks like. So I'm going to p let's do Channel 10 and maybe only the first 20 time points. That should be sufficient. All right. This is definitely not what you would expect. Phase angle time series to look like. This does actually look pretty cool. You can imagine making these lines a little bit thicker and stretching them out a little bit and, you know, printing it out and hanging up on your wall. I think that would be a nice decoration, maybe for some hip cocktail bar or something like that. Anyway, for signal processing. That is absolutely wrong. So now what I'm going to do is put these apostrophes back in here. Let's see. So this was transposed and then this was dot transpose and now I will plot the same thing again. This looks much better, maybe less interesting for our imaginary cocktail lounge. But in terms of signal processing and data analysis, this really looks good. All right. So let's see. And then I'm just going to run this whole cell to also create this. Now we have this variable that you can see that is now the same size as the original data. So I've just reshaped this Aperture Time series back into the channels by time by trials matrix. And it's also good to plot a little bit. So this is how that and then it's also do Channel Ten all the time points and trial one, two, three. OK, so that looks pretty reasonable. You see power fluctuations at ten hertz going up and we can actually add the time back in here. So now this also seems interpretable after time zero. You got a little burst of energy here. And then, uh, after the second stimulus or after the stimulus changes polarity, then you see there's a steady increase. When the stimulus comes off the screen, there's a decrease, so. That seems to be pretty plausible. Now let's see what's happening in this cell and we have a loop over trials on a set trial. Is looping index variable to be one? And we can see what's going on here. So we say match and it's this frequency and all channels of channels. So this is going to be a two slice of this 3D matrix equals itself, plus the output of the core function. Now the core function is in the statistics toolbox. So you could also replace this with core KOF if you don't have the stats toolbox. So let's see the core function. The input is the power data and let's see what that power, what the input is. So it's going to be actually let's look at the size of this. So it's seven sixty three by sixteen. So 16 is of course channels and seven sixty three might not be a number that sounds familiar from working with this data set. However, you can see that there is this variable here t idex. This was the logical index that contains all the time points that we want to analyze. And so there's going to be seven hundred and sixty three of these guys can say some to IDEX and that is seven hundred and sixty three values of one in this matrix and the rest are all zeros. So basically I'm inputting a matrix and it's going to be channels by time, by well by nothing, because that singleton dimension gets squeezed out and then I transpose it ends up being time by channels here. This input says type S and the S is for experiments. I'm going to be computing a Spearmon correlation. So let's see what happens when I run this, this bit of code. So I get a matrix that looks like this. This turns out to be a 16 by 16 matrix. So channels by channels. And essentially this is all of the channel inter correlations. In trial one, so we can also visualize this to see what it looks like. That's the image as the ends. And here is what the channel by Channel Correlation Matrix looks like for the Power Time series for 10 hertz for one trial. Now, this looks mostly like noise. This doesn't really look like it has any meaningful or at least immediately interpretable structure. Now, part of that is because this is just one out of two hundred trials. And part of that is because, in fact, in this dataset, there isn't really a whole lot of interesting stuff happening at 10 hertz. So, in fact, you wouldn't really expect to see a whole lot of structure in this matrix. But you know that this is a correlation matrix. So a couple of things are always good to look for. One is that the diagonal should be all ones. And you can see this as well and the numbers printed out here. And that, of course, is required because every variable is perfectly correlated with itself. And the other thing you should see is that this matrix is symmetric and certainly just from, you know, a quick visualization, it appears to be symmetric. All right. So compute the correlation matrix the channel by channel correlation matrix for each trial and then for each frequency. And once these all get added up, they need to be divided by the number of trials and that ultimately gives the average correlation matrix. All right, so that took about 15 seconds to run on my computer. Now I'm going to do some plotting. So the idea is that this is a three dimensional cube of numbers. So frequencies by channels, by channels. So how do we visualize this cube? Now, if we were four dimensional beings, we would have a three dimensional monitor and we could easily just look at the entire cube. But unfortunately, we are three dimensional beings and we have a two dimensional monitor. So we can't look at this entire cube all at once. Instead, what we are going to do is plot specific frequencies. And that's what I do here. So let me first get down to this for Loop and then I'll get to this plot line. So here's a loop over three. So this is hard coded to be three. So it has to be three elements here because. The code is written for exactly three different frequencies to plot, so I find which index corresponds to this frequency and Hertz, and then I just make an image of the correlation matrix at that frequency. And then just a couple of other things to make it look a little prettier. And what I do here in this time is make a plot of frequency by something. So let's see what that something is. So I'm taking the correlation matrix and I'm reshaping it to be numb for X, which is 30 by empty, which means whatever it ends up being. So this case channels by channels of 16 by 16. And then I'm squaring all of those elements and then I'm taking the mean over the second dimension, so let's think about what this ends up being. So this right here is going to become a two dimensional matrix of frequencies by channel pairs. And I'm squaring it. And the reason why I'm squaring it is that correlations can be positive or negative. In some sense. They can be interpreted the same way in that any correlation that deviates from zero indicates some kind of linear relationship between two variables. The sign, of course, tells you whether they both go up and down together or one goes up and the other one goes down. But in this particular case, I want a summary measure of the entire matrix. So I just want to know in general over the different frequencies, which frequencies have stronger linear relationships across pairs of channels, which frequencies have weaker linear relationships across the channels. So therefore, I'm squaring the the values so they all become positive. And that basically means that I can average them together without worrying about just regression to the mean. All right. So with that said, now I can run this cell and you can see what this looks like. So here is the correlation. And again, this is our squares. The correlation coefficient squared averaged over all of the channel pairs. This is some, but it's actually the average over the different frequencies. So this is pretty interesting as a summary measure. You see that there is something that looks a bit like a one over F. I think if you wanted to really interpret this as one over F, you would probably want to go down to lower frequencies and maybe go up to higher frequencies as well. But it looks like a little bit of a one. And there's clearly some kind of increase in the linear relationships in the gamma range around, you know, thirty eight or so to around sixty five hertz. And also appears to be that there are two. So I look at this and I see that there's kind of two peaks. There's one lower gamma peak and one higher gamma peak. Here you see the correlation matrices for these three frequencies. So low gamma and slightly higher gamma, the middle gamma. Maybe we should call this. And it's pretty interesting just qualitatively to see that connectivity. Remember, this is all connectivity simultaneously in time, but separated according to frequency. So when we separate the data by frequency, we see different patterns emerging. And it's also pretty interesting to see that the difference between 41 and 56 hertz looks like there's something special about Channel 11 that is joining this network at at higher frequencies and not participating in this network at slightly lower frequencies. OK, so the last thing that I want to do is to make an animation. And actually I think I'll show you this animation first and then I'll walk you through it. So let's see here. Go. So you see this channel by channel connectivity matrix changing for each one of these frequencies as we go from lower to higher frequencies. So now let me get back here, and I don't want to spend too too much time talking about the Matlab mechanics of how I make this animation, so I'll just go through it briefly beside the key is to set handles to these different plotting objects because the animations you never want to redraw figures or I should say you should avoid redrawing figures or objects and figures as much as possible. Instead, you want to create those objects initially and just update the handles. So I have a handle to the image, which actually just starts off as random numbers. And then I have an object to the title here. I'm plotting again the same plot that I have in the previous figure. And I have a handle to this plot, which is a red line, and that's going to go over the different frequencies. All right. So then inside this loop, so inside the animation loop, I'm not computing anything. I'm not redrawing anything. All I'm doing is updating properties of the graphics. In this case, for the image, I'm updating KeyData, which is the color data, and that gets updated according to the correlation matrix for this frequency, and then I'll update the title and in particular the string property and then update the exact data of the line, which is basically the x axis location of the line. And then I pause four point three seconds. And that basically just allows you to visualize this thing. So run through this again, because I think it's pretty neat to look at. And if you like, you can sample at higher frequencies and that will just make the animation a little bit smoother. And it's also pretty interesting to see as you go through these frequencies where these networks are emerging and how kind of widespread they are across the different channels.